# UI Compliance Remediation Plan

## Objective
Normalize ATLVS UI implementation to design-system-first standards:

1. Layout/template contract compliance
2. Semantic token usage (no hardcoded palette classes)
3. Reusable primitive usage (no stray native controls unless explicitly exempt)
4. Eliminate inline/literal style debt

## Inventory (Current)
Source: `tmp_ui_audit.json` generated by `node scripts/ui-compliance-audit.mjs`.

- Total pages: **313**
- Pages without layout contract: **0**
- Palette class occurrences: **652** across **71 files**
- Inline style occurrences: **74** across **39 files**
- Native control occurrences: **64** across **52 files**
- Literal color occurrences: **34** across **7 files**
- Total compliance issue occurrences: **824** across **138 files**

## Remediation Executed in This Batch

### 1) Audit hardening + repeatable inventory
- Added `scripts/ui-compliance-audit.mjs`.
- Added package scripts:
  - `npm run audit:ui`
  - `npm run audit:ui:strict`
- Corrected audit logic:
  - Counts route-level `layout.tsx` contracts
  - Avoids false positives for component tags (`<Input />` etc.)
  - Allows explicit native-control exceptions (currently map marker overlay buttons)

### 2) Primitive migration (native controls -> DS components)
- `src/components/templates/SettingsTemplate.tsx`
  - native `<textarea>` -> `Textarea`
- `src/components/views/toolbar.tsx`
  - native `<button>` drag handle -> `Button`
  - native checkbox + label -> `Checkbox` + `Label`
  - hidden file input -> `Input type="file"`
- `src/components/views/MasterCalendar.tsx`
  - modal native `input/textarea/label` -> `Input`/`Textarea`/`Label`

### 3) Semantic token migration (hardcoded palette -> DS tokens)
- `src/components/productions/runsheet/ShowCallingView.tsx`
  - cue color map migrated to `SEMANTIC_BADGE_CLASSES`
  - zinc/emerald palette classes removed
  - cue list native button migrated to DS `Button`
- `src/components/people/WorkforceAnalytics.tsx`
  - purple/zinc/rose/emerald/amber/orange/blue palette classes migrated to semantic/muted tokens
- `src/components/operations/CrewCheckinKiosk.tsx`
  - neutral/emerald palette classes migrated to semantic/muted tokens
- `src/app/(app)/finance/invoices/builder/page.tsx`
  - emerald classes migrated to `text-semantic-success`
- `src/app/(app)/account/history/page.tsx`
  - `text-blue-500` / `text-purple-500` migrated to semantic token classes

## Measurable Progress
Compared to the corrected baseline before remediation in this task:

- Total issues: **1013 -> 824** (**-189**)
- Palette occurrences: **823 -> 652** (**-171**)
- Native controls: **82 -> 64** (**-18**)
- Files with issues: **147 -> 138** (**-9**)
- Layout violations: **0 -> 0**

## Remaining Plan (Execution Order)

### Phase A — Palette debt burn-down (high impact)
Target top offenders from `tmp_ui_audit.json`:
- `src/components/people/PerformanceReviewDashboard.tsx`
- `src/components/people/EmployeePortal.tsx`
- `src/app/p/[slug]/page.tsx`
- `src/app/(app)/finance/components/BankReconciliation.tsx`
- `src/components/productions/RunOfShow.tsx`
- `src/app/(app)/people/components/{CertificationDashboard,ClockInOut}.tsx`

### Phase B — Inline style normalization
Replace inline style blocks with:
- class utilities driven by design tokens
- CSS vars where dynamic color is required

### Phase C — Native control cleanup
Migrate remaining native controls to DS primitives.
Keep only explicit exceptions where DS primitives are not feasible (documented in audit allowlist).

### Phase D — Enforcement
- Run `npm run audit:ui:strict` in CI after current debt is reduced to acceptable threshold.
- Keep `tmp_ui_audit.json` as machine-readable progress artifact.

## Operating Rules
- No compatibility shims/workarounds; remediate at source.
- Prefer tokenized classes (`semantic`, `muted`, `foreground`, `border`) over palette classes.
- Prefer component primitives over bespoke HTML controls.
