# UI Compliance Remediation Plan

## Status
✅ **Complete** — UI compliance remediation reached zero violations and is now enforced in CI.

## Objective
Normalize ATLVS UI implementation to design-system-first standards:

1. Layout/template contract compliance
2. Semantic token usage (no hardcoded palette classes)
3. Reusable primitive usage (no stray native controls unless explicitly exempt)
4. Eliminate inline/literal style debt

## Inventory (Current)
Source: `tmp_ui_audit.json` generated by `npm run audit:ui:strict`.

- Total pages: **310**
- Pages without layout contract: **0**
- Palette class occurrences: **0** across **0 files**
- Inline style occurrences: **0** across **0 files**
- Native control occurrences: **0** across **0 files**
- Literal color occurrences: **0** across **0 files**
- Total compliance issue occurrences: **0** across **0 files**

## Remediation Executed in This Batch

### 1) Audit hardening + repeatable inventory
- Added `scripts/ui-compliance-audit.mjs`.
- Added package scripts:
  - `npm run audit:ui`
  - `npm run audit:ui:strict`
- Corrected audit logic:
  - Counts route-level `layout.tsx` contracts
  - Avoids false positives for component tags (`<Input />` etc.)
  - Allows explicit native-control exceptions (currently map marker overlay buttons)

### 2) Primitive migration (native controls -> DS components)
- `src/components/templates/SettingsTemplate.tsx`
  - native `<textarea>` -> `Textarea`
- `src/components/views/toolbar.tsx`
  - native `<button>` drag handle -> `Button`
  - native checkbox + label -> `Checkbox` + `Label`
  - hidden file input -> `Input type="file"`
- `src/components/views/MasterCalendar.tsx`
  - modal native `input/textarea/label` -> `Input`/`Textarea`/`Label`

### 3) Semantic token migration (hardcoded palette -> DS tokens)
- `src/components/productions/runsheet/ShowCallingView.tsx`
  - cue color map migrated to `SEMANTIC_BADGE_CLASSES`
  - zinc/emerald palette classes removed
  - cue list native button migrated to DS `Button`
- `src/components/people/WorkforceAnalytics.tsx`
  - purple/zinc/rose/emerald/amber/orange/blue palette classes migrated to semantic/muted tokens
- `src/components/operations/CrewCheckinKiosk.tsx`
  - neutral/emerald palette classes migrated to semantic/muted tokens
- `src/app/(app)/finance/invoices/builder/page.tsx`
  - emerald classes migrated to `text-semantic-success`
- `src/app/(app)/account/history/page.tsx`
  - `text-blue-500` / `text-purple-500` migrated to semantic token classes

## Measurable Progress
Compared to the corrected baseline before remediation in this task:

- Total issues: **1013 -> 0**
- Palette occurrences: **823 -> 0**
- Native controls: **82 -> 0**
- Files with issues: **147 -> 0**
- Layout violations: **0 -> 0**

## Enforcement

- `npm run audit:ui` for local inventory checks
- `npm run audit:ui:strict` for local pre-merge validation
- `npm run typecheck` for deterministic project-local TypeScript validation
- CI now runs `npm run audit:ui:strict` in `.github/workflows/ci.yml`
- CI Type Check runs `npm run typecheck` (project-local `typescript`)
- `tmp_ui_audit.json` remains the machine-readable compliance artifact

## Remaining Work

None for UI compliance remediation. Maintain strict enforcement and keep allowlist exceptions explicit and documented.

## Operating Rules
- No compatibility shims/workarounds; remediate at source.
- Prefer tokenized classes (`semantic`, `muted`, `foreground`, `border`) over palette classes.
- Prefer component primitives over bespoke HTML controls.
