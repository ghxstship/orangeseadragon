[{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/(app)/finance/components/ReceiptUploader.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":207,"column":21,"nodeType":"JSXOpeningElement","endLine":211,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  Upload, \n  Camera, \n  FileImage, \n  X, \n  Check, \n  Loader2,\n  AlertCircle,\n  ScanLine\n} from 'lucide-react';\nimport { cn } from '@/lib/utils';\n\ninterface UploadedReceipt {\n  id: string;\n  file: File;\n  preview: string;\n  status: 'uploading' | 'processing' | 'completed' | 'failed';\n  progress: number;\n  extractedData?: {\n    vendor?: string;\n    amount?: number;\n    date?: string;\n    category?: string;\n    confidence?: number;\n  };\n  error?: string;\n}\n\ninterface ReceiptUploaderProps {\n  onUploadComplete: (receipts: UploadedReceipt[]) => void;\n  maxFiles?: number;\n}\n\nexport function ReceiptUploader({ onUploadComplete, maxFiles = 10 }: ReceiptUploaderProps) {\n  const [receipts, setReceipts] = useState<UploadedReceipt[]>([]);\n  const [isDragging, setIsDragging] = useState(false);\n\n  const processFile = async (file: File): Promise<UploadedReceipt> => {\n    const id = crypto.randomUUID();\n    const preview = URL.createObjectURL(file);\n    \n    const receipt: UploadedReceipt = {\n      id,\n      file,\n      preview,\n      status: 'uploading',\n      progress: 0,\n    };\n\n    setReceipts((prev) => [...prev, receipt]);\n\n    // Simulate upload progress\n    for (let i = 0; i <= 100; i += 20) {\n      await new Promise((resolve) => setTimeout(resolve, 100));\n      setReceipts((prev) =>\n        prev.map((r) => (r.id === id ? { ...r, progress: i } : r))\n      );\n    }\n\n    // Simulate OCR processing\n    setReceipts((prev) =>\n      prev.map((r) => (r.id === id ? { ...r, status: 'processing' } : r))\n    );\n\n    await new Promise((resolve) => setTimeout(resolve, 1500));\n\n    // Simulate extracted data (in production, this would come from OCR API)\n    const extractedData = {\n      vendor: 'Sample Vendor',\n      amount: Math.round(Math.random() * 500 * 100) / 100,\n      date: new Date().toISOString().split('T')[0],\n      category: ['Meals', 'Travel', 'Software', 'Office Supplies'][Math.floor(Math.random() * 4)],\n      confidence: 0.85 + Math.random() * 0.15,\n    };\n\n    setReceipts((prev) =>\n      prev.map((r) =>\n        r.id === id\n          ? { ...r, status: 'completed', extractedData }\n          : r\n      )\n    );\n\n    return { ...receipt, status: 'completed', extractedData };\n  };\n\n  const handleFiles = useCallback(async (files: FileList | File[]) => {\n    const fileArray = Array.from(files).slice(0, maxFiles - receipts.length);\n    const validFiles = fileArray.filter((file) =>\n      file.type.startsWith('image/') || file.type === 'application/pdf'\n    );\n\n    for (const file of validFiles) {\n      await processFile(file);\n    }\n  }, [receipts.length, maxFiles]);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    handleFiles(e.dataTransfer.files);\n  }, [handleFiles]);\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  }, []);\n\n  const removeReceipt = (id: string) => {\n    setReceipts((prev) => {\n      const receipt = prev.find((r) => r.id === id);\n      if (receipt?.preview) {\n        URL.revokeObjectURL(receipt.preview);\n      }\n      return prev.filter((r) => r.id !== id);\n    });\n  };\n\n  const completedReceipts = receipts.filter((r) => r.status === 'completed');\n\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <ScanLine className=\"h-5 w-5\" />\n          Upload Receipts\n        </CardTitle>\n        <CardDescription>\n          Upload receipt images or PDFs for automatic data extraction\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div\n          onDrop={handleDrop}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          className={cn(\n            'flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-8 transition-colors',\n            isDragging\n              ? 'border-primary bg-primary/5'\n              : 'border-muted-foreground/25 hover:border-primary/50'\n          )}\n        >\n          <Upload className=\"mb-4 h-10 w-10 text-muted-foreground\" />\n          <p className=\"mb-2 text-center font-medium\">\n            Drag and drop receipts here\n          </p>\n          <p className=\"mb-4 text-center text-sm text-muted-foreground\">\n            or click to browse (JPG, PNG, PDF)\n          </p>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => document.getElementById('receipt-input')?.click()}\n            >\n              <FileImage className=\"mr-2 h-4 w-4\" />\n              Browse Files\n            </Button>\n            <Button\n              variant=\"outline\"\n              onClick={() => document.getElementById('receipt-camera')?.click()}\n            >\n              <Camera className=\"mr-2 h-4 w-4\" />\n              Take Photo\n            </Button>\n          </div>\n          <input\n            id=\"receipt-input\"\n            type=\"file\"\n            accept=\"image/*,.pdf\"\n            multiple\n            className=\"hidden\"\n            onChange={(e) => e.target.files && handleFiles(e.target.files)}\n          />\n          <input\n            id=\"receipt-camera\"\n            type=\"file\"\n            accept=\"image/*\"\n            capture=\"environment\"\n            className=\"hidden\"\n            onChange={(e) => e.target.files && handleFiles(e.target.files)}\n          />\n        </div>\n\n        {receipts.length > 0 && (\n          <div className=\"space-y-3\">\n            <h4 className=\"font-medium\">Uploaded Receipts ({receipts.length})</h4>\n            {receipts.map((receipt) => (\n              <div\n                key={receipt.id}\n                className=\"flex items-center gap-4 rounded-lg border p-3\"\n              >\n                <div className=\"relative h-16 w-16 flex-shrink-0 overflow-hidden rounded-md bg-muted\">\n                  {receipt.file.type.startsWith('image/') ? (\n                    <img\n                      src={receipt.preview}\n                      alt=\"Receipt\"\n                      className=\"h-full w-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"flex h-full w-full items-center justify-center\">\n                      <FileImage className=\"h-8 w-8 text-muted-foreground\" />\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"min-w-0 flex-1\">\n                  <p className=\"truncate font-medium\">{receipt.file.name}</p>\n                  \n                  {receipt.status === 'uploading' && (\n                    <div className=\"mt-1\">\n                      <Progress value={receipt.progress} className=\"h-1\" />\n                      <p className=\"mt-1 text-xs text-muted-foreground\">\n                        Uploading... {receipt.progress}%\n                      </p>\n                    </div>\n                  )}\n\n                  {receipt.status === 'processing' && (\n                    <div className=\"mt-1 flex items-center gap-2 text-sm text-muted-foreground\">\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      Extracting data...\n                    </div>\n                  )}\n\n                  {receipt.status === 'completed' && receipt.extractedData && (\n                    <div className=\"mt-1 flex flex-wrap items-center gap-2\">\n                      <Badge variant=\"secondary\">\n                        {receipt.extractedData.vendor}\n                      </Badge>\n                      <Badge variant=\"outline\">\n                        ${receipt.extractedData.amount?.toFixed(2)}\n                      </Badge>\n                      <Badge variant=\"outline\">\n                        {receipt.extractedData.category}\n                      </Badge>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {Math.round((receipt.extractedData.confidence || 0) * 100)}% confidence\n                      </span>\n                    </div>\n                  )}\n\n                  {receipt.status === 'failed' && (\n                    <div className=\"mt-1 flex items-center gap-2 text-sm text-destructive\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {receipt.error || 'Failed to process'}\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex items-center gap-2\">\n                  {receipt.status === 'completed' && (\n                    <Check className=\"h-5 w-5 text-emerald-600 dark:text-emerald-400\" />\n                  )}\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => removeReceipt(receipt.id)}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {completedReceipts.length > 0 && (\n          <div className=\"flex justify-end gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setReceipts([])}\n            >\n              Clear All\n            </Button>\n            <Button onClick={() => onUploadComplete(completedReceipts)}>\n              Create {completedReceipts.length} Expense{completedReceipts.length > 1 ? 's' : ''}\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/(app)/finance/invoices/components/InvoiceDrawer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[456,459],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[456,459],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription, SheetFooter } from '@/components/ui/sheet';\nimport { Button } from '@/components/ui/button';\nimport { Separator } from '@/components/ui/separator';\nimport { Badge } from '@/components/ui/badge';\nimport { Download, Send, CreditCard, Clock } from 'lucide-react';\n\ninterface InvoiceDrawerProps {\n    open: boolean;\n    onOpenChange: (open: boolean) => void;\n    invoice: any; // Using any for now, ideally strictly typed\n}\n\nexport function InvoiceDrawer({ open, onOpenChange, invoice }: InvoiceDrawerProps) {\n    if (!invoice) return null;\n\n    return (\n        <Sheet open={open} onOpenChange={onOpenChange}>\n            <SheetContent className=\"w-[400px] sm:w-[540px] overflow-y-auto\">\n                <SheetHeader className=\"mb-6\">\n                    <div className=\"flex items-center justify-between\">\n                        <SheetTitle>Invoice #{invoice.invoice_number}</SheetTitle>\n                        <Badge variant={invoice.status === 'paid' ? 'default' : 'destructive'}>\n                            {invoice.status}\n                        </Badge>\n                    </div>\n                    <SheetDescription>\n                        Billed to {invoice.customer_name || 'Unknown Customer'}\n                    </SheetDescription>\n                </SheetHeader>\n\n                <div className=\"space-y-6\">\n                    <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                        <div>\n                            <p className=\"text-muted-foreground\">Issue Date</p>\n                            <p className=\"font-medium\">{invoice.issue_date || 'N/A'}</p>\n                        </div>\n                        <div>\n                            <p className=\"text-muted-foreground\">Due Date</p>\n                            <p className=\"font-medium\">{invoice.due_date || 'N/A'}</p>\n                        </div>\n                        <div>\n                            <p className=\"text-muted-foreground\">Amount</p>\n                            <p className=\"font-medium text-lg\">${invoice.total_amount?.toLocaleString()}</p>\n                        </div>\n                    </div>\n\n                    <Separator />\n\n                    <div>\n                        <h4 className=\"text-sm font-medium mb-4\">Activity Timeline</h4>\n                        <div className=\"space-y-4\">\n                            {/* Mock timeline for now */}\n                            <div className=\"flex items-start gap-3 text-sm\">\n                                <div className=\"p-2 bg-muted rounded-full\"><Clock className=\"h-3 w-3\" /></div>\n                                <div>\n                                    <p className=\"font-medium\">Invoice Created</p>\n                                    <p className=\"text-xs text-muted-foreground\">Feb 5, 2026 at 10:00 AM</p>\n                                </div>\n                            </div>\n                            <div className=\"flex items-start gap-3 text-sm\">\n                                <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-full\"><Send className=\"h-3 w-3 text-blue-600\" /></div>\n                                <div>\n                                    <p className=\"font-medium\">Sent to Client</p>\n                                    <p className=\"text-xs text-muted-foreground\">Feb 5, 2026 at 10:05 AM</p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <SheetFooter className=\"mt-8 flex-col gap-2 sm:flex-col items-stretch\">\n                    <Button className=\"w-full\">\n                        <CreditCard className=\"mr-2 h-4 w-4\" />\n                        Record Payment\n                    </Button>\n                    <div className=\"flex gap-2\">\n                        <Button variant=\"outline\" className=\"flex-1\">\n                            <Download className=\"mr-2 h-4 w-4\" /> PDF\n                        </Button>\n                        <Button variant=\"outline\" className=\"flex-1\">\n                            <Send className=\"mr-2 h-4 w-4\" /> Resend\n                        </Button>\n                    </div>\n                </SheetFooter>\n            </SheetContent>\n        </Sheet>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/(app)/finance/invoices/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[350,353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[350,353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":13,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[488,491],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[488,491],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Plus } from 'lucide-react';\nimport { InvoiceList } from './components/InvoiceList';\nimport { InvoiceDrawer } from './components/InvoiceDrawer';\n\nexport default function InvoicesPage() {\n  const [selectedInvoice, setSelectedInvoice] = useState<any>(null); // Ideally strictly typed\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\n\n  const handleInvoiceSelect = (invoice: any) => {\n    setSelectedInvoice(invoice);\n    setIsDrawerOpen(true);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full bg-background\">\n      <header className=\"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-40\">\n        <div className=\"flex items-center justify-between px-6 py-4\">\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight\">Invoices</h1>\n            <p className=\"text-muted-foreground\">Manage customer billing and payments</p>\n          </div>\n          <Button>\n            <Plus className=\"mr-2 h-4 w-4\" /> Create Invoice\n          </Button>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-auto p-6 space-y-6\">\n        <InvoiceList onSelectInvoice={handleInvoiceSelect} />\n\n        <InvoiceDrawer\n          open={isDrawerOpen}\n          onOpenChange={setIsDrawerOpen}\n          invoice={selectedInvoice}\n        />\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/(app)/people/rosters/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[926,929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[926,929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":37,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1674,1677],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1674,1677],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useCrud } from '@/lib/crud/hooks/useCrud';\nimport { peopleSchema } from '@/lib/schemas/people';\nimport { HolographicDirectory } from '@/components/people/HolographicDirectory';\nimport { LifeStreamProfile } from '@/components/people/LifeStreamProfile';\nimport { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from '@/components/ui/sheet';\nimport { Loader2 } from 'lucide-react';\n\nexport default function RostersPage() {\n  const { data: people, loading } = useCrud(peopleSchema);\n  const [selectedPersonId, setSelectedPersonId] = useState<string | null>(null);\n\n  // In a real app, we might want to fetch the single record detail here when selected\n  // For now, we find from the list or just pass the ID to LifeStreamProfile if it fetches itself\n  // But LifeStreamProfile currently expects a 'person' object.\n  const selectedPerson = people.find((p: any) => p.id === selectedPersonId);\n\n  return (\n    <div className=\"flex flex-col h-full bg-background\">\n      <header className=\"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 sticky top-0 z-40 px-6 py-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold tracking-tight\">Live Roster</h2>\n          <p className=\"text-muted-foreground\">Real-time workforce directory</p>\n        </div>\n      </header>\n\n      <div className=\"flex-1 overflow-auto p-6\">\n\n      {loading ? (\n        <div className=\"flex items-center justify-center h-64\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n        </div>\n      ) : (\n        <HolographicDirectory\n          people={people.map((p: any) => ({\n            ...p,\n            // Map schema fields to component props if needed, or ensure schema matches\n            status: p.is_available_for_hire ? 'online' : 'offline', // Simple mapping for now\n            headline: p.headline || 'Untitled Staff'\n          }))}\n          onSelectPerson={setSelectedPersonId}\n        />\n      )}\n\n      <Sheet open={!!selectedPersonId} onOpenChange={(open) => !open && setSelectedPersonId(null)}>\n        <SheetContent side=\"right\" className=\"w-[90%] sm:w-[600px] xl:w-[800px] overflow-y-auto p-0\">\n          {selectedPerson && (\n            <div className=\"h-full flex flex-col\">\n              <div className=\"p-6 border-b\">\n                <SheetHeader>\n                  <SheetTitle className=\"text-2xl\">{selectedPerson.headline}</SheetTitle>\n                  <SheetDescription>{selectedPerson.location || 'No location set'}</SheetDescription>\n                </SheetHeader>\n              </div>\n              <div className=\"flex-grow p-6\">\n                <LifeStreamProfile person={selectedPerson} />\n              </div>\n            </div>\n          )}\n        </SheetContent>\n      </Sheet>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/advancing/workflows/execute/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":211,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5979,5982],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5979,5982],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8542,8545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8542,8545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, apiCreated, badRequest, notFound, supabaseError } from '@/lib/api/response';\n\ninterface WorkflowStep {\n  type: 'action' | 'condition' | 'wait' | 'branch';\n  action?: string;\n  config?: Record<string, unknown>;\n}\n\ninterface StepResult {\n  step: number;\n  type: string;\n  status: 'completed' | 'failed' | 'skipped';\n  output?: Record<string, unknown>;\n  error?: string;\n  completed_at: string;\n}\n\nexport async function POST(request: NextRequest) {\n  const auth = await requireAuth();\n  if (auth.error) return auth.error;\n  const { user, supabase } = auth;\n  \n  try {\n    const body = await request.json();\n    const { workflowId, entityType, entityId, triggerData } = body;\n    \n    if (!workflowId) {\n      return badRequest('workflowId is required');\n    }\n    \n    const userId = user.id;\n    \n    // Get the workflow\n    const { data: workflow, error: workflowError } = await supabase\n      .from('workflows')\n      .select('*')\n      .eq('id', workflowId)\n      .eq('is_active', true)\n      .single();\n    \n    if (workflowError || !workflow) {\n      return notFound('Workflow not found or inactive');\n    }\n    \n    // Check if already executed for this entity (if run_once_per_entity)\n    if (workflow.run_once_per_entity && entityId) {\n      const { data: existing } = await supabase\n        .from('workflow_executions')\n        .select('id')\n        .eq('workflow_id', workflowId)\n        .eq('entity_id', entityId)\n        .eq('status', 'completed')\n        .single();\n      \n      if (existing) {\n        return badRequest('Workflow already executed for this entity');\n      }\n    }\n    \n    // Create execution record\n    const { data: execution, error: execError } = await supabase\n      .from('workflow_executions')\n      .insert({\n        organization_id: workflow.organization_id,\n        workflow_id: workflowId,\n        entity_type: entityType || workflow.entity_type,\n        entity_id: entityId,\n        triggered_by: 'manual',\n        trigger_data: triggerData || {},\n        status: 'running',\n        started_at: new Date().toISOString(),\n        initiated_by: userId,\n      })\n      .select()\n      .single();\n    \n    if (execError) {\n      return supabaseError(execError);\n    }\n    \n    // Execute workflow steps\n    const steps = workflow.steps as WorkflowStep[];\n    const stepResults: StepResult[] = [];\n    let currentStep = 0;\n    let shouldContinue = true;\n    \n    // Build context for step execution\n    const context: Record<string, unknown> = {\n      workflow,\n      entity_type: entityType || workflow.entity_type,\n      entity_id: entityId,\n      trigger_data: triggerData || {},\n      now: new Date().toISOString(),\n    };\n    \n    // Load entity data if available\n    if (entityId && entityType) {\n      const tableName = getTableName(entityType);\n      if (tableName) {\n        const { data: entity } = await supabase\n          .from(tableName)\n          .select('*')\n          .eq('id', entityId)\n          .single();\n        \n        if (entity) {\n          context.entity = entity;\n        }\n      }\n    }\n    \n    while (currentStep < steps.length && shouldContinue) {\n      const step = steps[currentStep];\n      \n      try {\n        const result = await executeStep(supabase, step, context, workflow.organization_id);\n        \n        stepResults.push({\n          step: currentStep,\n          type: step.type,\n          status: result.success ? 'completed' : 'failed',\n          output: result.output,\n          error: result.error,\n          completed_at: new Date().toISOString(),\n        });\n        \n        // Update context with step output\n        if (result.output) {\n          context[`step_${currentStep}_output`] = result.output;\n        }\n        \n        // Handle conditions\n        if (step.type === 'condition' && !result.success) {\n          shouldContinue = false;\n        }\n        \n        // Handle wait steps\n        if (step.type === 'wait') {\n          // Update execution to waiting status\n          await supabase\n            .from('workflow_executions')\n            .update({\n              status: 'waiting',\n              current_step: currentStep,\n              step_results: stepResults,\n            })\n            .eq('id', execution.id);\n          \n          return apiSuccess({\n            executionId: execution.id,\n            status: 'waiting',\n            currentStep,\n            waitingFor: step.config?.for,\n          });\n        }\n        \n        currentStep++;\n      } catch (error) {\n        stepResults.push({\n          step: currentStep,\n          type: step.type,\n          status: 'failed',\n          error: error instanceof Error ? error.message : 'Unknown error',\n          completed_at: new Date().toISOString(),\n        });\n        \n        shouldContinue = false;\n      }\n    }\n    \n    // Update execution with final status\n    const finalStatus = stepResults.every(r => r.status !== 'failed') ? 'completed' : 'failed';\n    \n    await supabase\n      .from('workflow_executions')\n      .update({\n        status: finalStatus,\n        current_step: currentStep,\n        step_results: stepResults,\n        completed_at: new Date().toISOString(),\n      })\n      .eq('id', execution.id);\n    \n    return apiCreated({\n      executionId: execution.id,\n      status: finalStatus,\n      stepsExecuted: currentStep,\n      stepResults,\n    });\n    \n  } catch {\n    return badRequest('Invalid request body');\n  }\n}\n\nfunction getTableName(entityType: string): string | null {\n  const tableMap: Record<string, string> = {\n    'advance_item': 'advance_items',\n    'production_advance': 'production_advances',\n    'crew_member': 'crew_members',\n    'crew_assignment': 'crew_assignments',\n    'event': 'events',\n  };\n  return tableMap[entityType] || null;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase client type\nasync function executeStep(\n  supabase: any,\n  step: WorkflowStep,\n  context: Record<string, unknown>,\n  organizationId: string\n): Promise<{ success: boolean; output?: Record<string, unknown>; error?: string }> {\n  \n  switch (step.type) {\n    case 'condition':\n      return executeCondition(step.config || {}, context);\n    \n    case 'action':\n      return executeAction(supabase, step.action || '', step.config || {}, context, organizationId);\n    \n    case 'wait':\n      return { success: true, output: { waiting: true, for: step.config?.for } };\n    \n    case 'branch':\n      // Branch logic would be handled by the main loop\n      return { success: true };\n    \n    default:\n      return { success: false, error: `Unknown step type: ${step.type}` };\n  }\n}\n\nfunction executeCondition(\n  config: Record<string, unknown>,\n  context: Record<string, unknown>\n): { success: boolean; output?: Record<string, unknown>; error?: string } {\n  const field = config.field as string;\n  const operator = config.operator as string;\n  const value = config.value;\n  \n  // Resolve field value from context\n  const fieldValue = resolveValue(field, context);\n  const compareValue = resolveValue(value, context);\n  \n  let result = false;\n  \n  switch (operator) {\n    case 'eq':\n      result = fieldValue === compareValue;\n      break;\n    case 'ne':\n      result = fieldValue !== compareValue;\n      break;\n    case 'gt':\n      result = Number(fieldValue) > Number(compareValue);\n      break;\n    case 'lt':\n      result = Number(fieldValue) < Number(compareValue);\n      break;\n    case 'gte':\n      result = Number(fieldValue) >= Number(compareValue);\n      break;\n    case 'lte':\n      result = Number(fieldValue) <= Number(compareValue);\n      break;\n    case 'in':\n      result = Array.isArray(compareValue) && compareValue.includes(fieldValue);\n      break;\n    case 'not_in':\n      result = Array.isArray(compareValue) && !compareValue.includes(fieldValue);\n      break;\n    case 'contains':\n      result = String(fieldValue).includes(String(compareValue));\n      break;\n    case 'starts_with':\n      result = String(fieldValue).startsWith(String(compareValue));\n      break;\n    case 'not_empty':\n      result = fieldValue !== null && fieldValue !== undefined && fieldValue !== '';\n      break;\n    default:\n      return { success: false, error: `Unknown operator: ${operator}` };\n  }\n  \n  return { success: result, output: { field, operator, fieldValue, compareValue, result } };\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase client type\nasync function executeAction(\n  supabase: any,\n  action: string,\n  config: Record<string, unknown>,\n  context: Record<string, unknown>,\n  organizationId: string\n): Promise<{ success: boolean; output?: Record<string, unknown>; error?: string }> {\n  \n  switch (action) {\n    case 'send_notification': {\n      const template = config.template as string;\n      const recipients = config.recipients as string[];\n      \n      // Resolve recipients\n      const userIds: string[] = [];\n      const entity = context.entity as Record<string, unknown> | undefined;\n      \n      for (const recipient of recipients) {\n        if (recipient === 'assigned_to' && entity?.assigned_to) {\n          userIds.push(entity.assigned_to as string);\n        } else if (recipient === 'created_by' && entity?.created_by) {\n          userIds.push(entity.created_by as string);\n        } else if (recipient.match(/^[0-9a-f-]{36}$/)) {\n          userIds.push(recipient);\n        }\n      }\n      \n      // Create notifications\n      const notifications = userIds.map(userId => ({\n        user_id: userId,\n        type: 'workflow',\n        title: `Workflow: ${template}`,\n        message: `Automated notification from workflow`,\n        data: {\n          template,\n          entity_type: context.entity_type,\n          entity_id: context.entity_id,\n        },\n      }));\n      \n      if (notifications.length > 0) {\n        await supabase.from('notifications').insert(notifications);\n      }\n      \n      return { success: true, output: { notificationsSent: notifications.length } };\n    }\n    \n    case 'update_field': {\n      const field = config.field as string;\n      const value = resolveValue(config.value, context);\n      const entityId = context.entity_id as string;\n      const entityType = context.entity_type as string;\n      \n      const tableName = getTableName(entityType);\n      if (!tableName || !entityId) {\n        return { success: false, error: 'Cannot update field: missing entity info' };\n      }\n      \n      const { error } = await supabase\n        .from(tableName)\n        .update({ [field]: value, updated_at: new Date().toISOString() })\n        .eq('id', entityId);\n      \n      if (error) {\n        return { success: false, error: error.message };\n      }\n      \n      return { success: true, output: { field, value } };\n    }\n    \n    case 'create_approval': {\n      const title = config.title as string;\n      const approvers = config.approvers as string[];\n      const approvalRule = (config.approval_rule as string) || 'any';\n      \n      const { data, error } = await supabase\n        .from('approval_requests')\n        .insert({\n          organization_id: organizationId,\n          entity_type: context.entity_type as string,\n          entity_id: context.entity_id as string,\n          approval_type: 'workflow',\n          title,\n          requested_by: (context.trigger_data as Record<string, unknown>)?.user_id || null,\n          approvers: approvers.map(a => ({ role: a })),\n          approval_rule: approvalRule,\n        })\n        .select()\n        .single();\n      \n      if (error) {\n        return { success: false, error: error.message };\n      }\n      \n      return { success: true, output: { approvalRequestId: data.id } };\n    }\n    \n    default:\n      return { success: false, error: `Unknown action: ${action}` };\n  }\n}\n\nfunction resolveValue(value: unknown, context: Record<string, unknown>): unknown {\n  if (typeof value !== 'string') return value;\n  \n  // Check for template syntax {{variable}}\n  const templateMatch = value.match(/^\\{\\{(.+)\\}\\}$/);\n  if (templateMatch) {\n    const path = templateMatch[1];\n    return getNestedValue(context, path);\n  }\n  \n  // Check for entity field reference\n  if (value.startsWith('entity.')) {\n    const field = value.substring(7);\n    const entity = context.entity as Record<string, unknown> | undefined;\n    return entity?.[field];\n  }\n  \n  return value;\n}\n\nfunction getNestedValue(obj: Record<string, unknown>, path: string): unknown {\n  const parts = path.split('.');\n  let current: unknown = obj;\n  \n  for (const part of parts) {\n    if (current === null || current === undefined) return undefined;\n    \n    // Handle array access like [0]\n    const arrayMatch = part.match(/^(.+)\\[(\\d+)\\]$/);\n    if (arrayMatch) {\n      const [, key, index] = arrayMatch;\n      current = (current as Record<string, unknown>)[key];\n      if (Array.isArray(current)) {\n        current = current[parseInt(index)];\n      }\n    } else {\n      current = (current as Record<string, unknown>)[part];\n    }\n  }\n  \n  return current;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/dashboards/[id]/widgets/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3255,3258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3255,3258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":72,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1866,1869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1866,1869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":"Supabase generated types stale; columns exist in migration 00082"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, apiCreated, badRequest, supabaseError, serverError } from '@/lib/api/response';\n\n/**\n * GET /api/dashboards/:id/widgets\n * \n * List all widgets for a specific dashboard, ordered by position.\n */\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const auth = await requireAuth();\n  if (auth.error) return auth.error;\n  const { supabase } = auth;\n\n  try {\n    const { id: dashboardId } = await params;\n\n    const { data: widgets, error } = await supabase\n      .from('dashboard_widgets')\n      .select('*')\n      .eq('dashboard_id', dashboardId)\n      .order('position_y', { ascending: true })\n      .order('position_x', { ascending: true });\n\n    if (error) {\n      return supabaseError(error);\n    }\n\n    return apiSuccess(widgets);\n  } catch (error) {\n    console.error('Error fetching dashboard widgets:', error);\n    return serverError();\n  }\n}\n\n/**\n * POST /api/dashboards/:id/widgets\n * \n * Add a new widget to a dashboard.\n */\nexport async function POST(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const auth = await requireAuth();\n  if (auth.error) return auth.error;\n  const { supabase } = auth;\n\n  try {\n    const { id: dashboardId } = await params;\n    const body = await request.json();\n\n    const {\n      title,\n      widget_type,\n      data_source,\n      config,\n      position_x,\n      position_y,\n      width,\n      height,\n    } = body;\n\n    if (!title || !widget_type) {\n      return badRequest('title and widget_type are required');\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase generated types stale; columns exist in migration 00082\n    const { data: widget, error: insertError } = await (supabase as any)\n      .from('dashboard_widgets')\n      .insert({\n        dashboard_id: dashboardId,\n        title,\n        widget_type,\n        data_source: data_source || null,\n        config: config || {},\n        position_x: position_x ?? 0,\n        position_y: position_y ?? 0,\n        width: width ?? 4,\n        height: height ?? 3,\n      })\n      .select()\n      .single();\n\n    if (insertError) {\n      return supabaseError(insertError);\n    }\n\n    return apiCreated(widget);\n  } catch (error) {\n    console.error('Error adding dashboard widget:', error);\n    return serverError();\n  }\n}\n\n/**\n * PATCH /api/dashboards/:id/widgets\n * \n * Bulk update widget positions (for drag-and-drop layout changes).\n */\nexport async function PATCH(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const auth = await requireAuth();\n  if (auth.error) return auth.error;\n  const { supabase } = auth;\n\n  try {\n    const { id: dashboardId } = await params;\n    const { widgets } = await request.json();\n\n    if (!Array.isArray(widgets)) {\n      return badRequest('widgets array is required');\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase generated types stale; columns exist in migration 00082\n    const updates = widgets.map((w: { id: string; position_x: number; position_y: number; width: number; height: number }) =>\n      (supabase as any)\n        .from('dashboard_widgets')\n        .update({\n          position_x: w.position_x,\n          position_y: w.position_y,\n          width: w.width,\n          height: w.height,\n        })\n        .eq('id', w.id)\n        .eq('dashboard_id', dashboardId)\n    );\n\n    await Promise.all(updates);\n\n    return apiSuccess({ updated: widgets.length });\n  } catch (error) {\n    console.error('Error updating widget positions:', error);\n    return serverError();\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/expenses/[id]/submit/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":66,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2111,2114],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2111,2114],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":134,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4537,4540],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4537,4540],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, badRequest, notFound, supabaseError, serverError } from '@/lib/api/response';\n\n/**\n * POST /api/expenses/[id]/submit\n * Submit an expense for approval - integrates with approval workflow system\n */\nexport async function POST(\n    request: NextRequest,\n    { params }: { params: Promise<{ id: string }> }\n) {\n    const { id } = await params;\n\n    try {\n        const auth = await requireAuth();\n        if (auth.error) return auth.error;\n        const { user, supabase } = auth;\n\n        // Get the expense\n        const { data: expense, error: fetchError } = await supabase\n            .from('expenses')\n            .select('*')\n            .eq('id', id)\n            .single();\n\n        if (fetchError || !expense) {\n            return notFound('Expense');\n        }\n\n        // Validate current status\n        if (expense.status !== 'draft') {\n            return badRequest(`Expense with status '${expense.status}' cannot be submitted`);\n        }\n\n        // Validate receipt is attached for reimbursable expenses\n        if (expense.is_reimbursable && !expense.receipt_url) {\n            return badRequest('Receipt is required for reimbursable expenses');\n        }\n\n        // Update expense status\n        const { data: updatedExpense, error: updateError } = await supabase\n            .from('expenses')\n            .update({\n                status: 'submitted',\n                submitted_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n            })\n            .eq('id', id)\n            .select()\n            .single();\n\n        if (updateError) {\n            return supabaseError(updateError);\n        }\n\n        // Find applicable approval workflow\n        const { data: workflow } = await supabase\n            .from('approval_workflows')\n            .select('*')\n            .eq('organization_id', expense.organization_id)\n            .eq('entity_type', 'expense')\n            .eq('is_active', true)\n            .single();\n\n        let approvalRequest: any = null;\n\n        if (workflow) {\n            // Create approval request\n            const { data: request } = await supabase\n                .from('approval_requests')\n                .insert({\n                    organization_id: expense.organization_id,\n                    approval_workflow_id: workflow.id,\n                    entity_type: 'expense',\n                    entity_id: id,\n                    status: 'pending',\n                    requested_by: user.id,\n                    requested_at: new Date().toISOString(),\n                })\n                .select()\n                .single();\n\n            approvalRequest = request;\n\n            // Notify approvers\n            const approvers = await getExpenseApprovers(supabase, workflow, expense);\n\n            if (approvers.length > 0) {\n                const notifications = approvers.map(approverId => ({\n                    organization_id: expense.organization_id,\n                    user_id: approverId,\n                    type: 'expense_pending_approval',\n                    title: 'Expense Pending Approval',\n                    message: `Expense of $${expense.amount} requires your approval`,\n                    data: {\n                        expense_id: id,\n                        amount: expense.amount,\n                        description: expense.description,\n                    },\n                    entity_type: 'expense',\n                    entity_id: id,\n                }));\n\n                await supabase.from('notifications').insert(notifications);\n            }\n        }\n\n        // Audit log\n        await supabase\n            .from('audit_logs')\n            .insert({\n                organization_id: expense.organization_id,\n                user_id: user.id,\n                action: 'expense_submitted',\n                entity_type: 'expense',\n                entity_id: id,\n                old_values: { status: 'draft' },\n                new_values: { status: 'submitted' },\n            });\n\n        return apiSuccess(updatedExpense, {\n            approval_request: approvalRequest,\n            message: 'Expense submitted for approval',\n        });\n    } catch (e) {\n        console.error('[API] Expense submit error:', e);\n        return serverError('Submission failed');\n    }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase client type\nasync function getExpenseApprovers(\n    supabase: any,\n    workflow: { approval_type: string; config: Record<string, unknown> },\n    expense: { organization_id: string; user_id: string }\n): Promise<string[]> {\n    const approvers: string[] = [];\n\n    switch (workflow.approval_type) {\n        case 'manager_hierarchy':\n            const { data: member } = await supabase\n                .from('organization_members')\n                .select('department_id')\n                .eq('user_id', expense.user_id)\n                .eq('organization_id', expense.organization_id)\n                .single();\n\n            if (member?.department_id) {\n                const { data: dept } = await supabase\n                    .from('departments')\n                    .select('manager_id')\n                    .eq('id', member.department_id)\n                    .single();\n\n                if (dept?.manager_id) {\n                    approvers.push(dept.manager_id);\n                }\n            }\n            break;\n\n        case 'role_based':\n            const roleId = (workflow.config as { approver_role_id?: string })?.approver_role_id;\n            if (roleId) {\n                const { data: roleMembers } = await supabase\n                    .from('organization_members')\n                    .select('user_id')\n                    .eq('organization_id', expense.organization_id)\n                    .eq('role_id', roleId);\n\n                if (roleMembers) {\n                    approvers.push(...roleMembers.map((m: { user_id: string }) => m.user_id));\n                }\n            }\n            break;\n    }\n\n    return approvers;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/purchase-requisitions/[id]/convert/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":77,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2894,2897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2894,2897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, badRequest, notFound, supabaseError, serverError } from '@/lib/api/response';\n\n/**\n * POST /api/purchase-requisitions/[id]/convert\n * Convert an approved purchase requisition into a Purchase Order\n */\nexport async function POST(\n    request: NextRequest,\n    { params }: { params: Promise<{ id: string }> }\n) {\n    const { id } = await params;\n\n    try {\n        const auth = await requireAuth();\n        if (auth.error) return auth.error;\n        const { user, supabase } = auth;\n\n        // 1. Fetch the requisition and its items\n        const { data: requisition, error: reqError } = await supabase\n            .from('purchase_requisitions')\n            .select('*, items:purchase_requisition_items(*)')\n            .eq('id', id)\n            .single();\n\n        if (reqError || !requisition) {\n            return notFound('Requisition');\n        }\n\n        // 2. Validate requisition status\n        if (requisition.status !== 'approved') {\n            return badRequest(`Only approved requisitions can be converted. Current status: ${requisition.status}`);\n        }\n\n        // 3. Check if already converted\n        const { data: existingPO } = await supabase\n            .from('purchase_orders')\n            .select('po_number')\n            .eq('requisition_id', id)\n            .single();\n\n        if (existingPO) {\n            return badRequest(`Requisition already converted to PO ${existingPO.po_number}`);\n        }\n\n        // 4. Group items by preferred vendor if applicable, or just create one PO for now\n        // For simplicity, we create one PO. In a real system, we might create multiple POs if vendors differ.\n        const vendorId = requisition.items?.[0]?.preferred_vendor_id || null;\n\n        // 5. Create the Purchase Order\n        const poNumber = `PO-${Date.now().toString().slice(-6)}`;\n        const { data: po, error: poError } = await supabase\n            .from('purchase_orders')\n            .insert({\n                organization_id: requisition.organization_id,\n                project_id: requisition.project_id,\n                event_id: requisition.event_id,\n                requisition_id: id,\n                vendor_id: vendorId,\n                po_number: poNumber,\n                status: 'draft',\n                order_date: new Date().toISOString().split('T')[0],\n                subtotal: requisition.estimated_total || 0,\n                total_amount: requisition.estimated_total || 0,\n                currency: requisition.currency || 'USD',\n                created_by: user.id\n            })\n            .select()\n            .single();\n\n        if (poError || !po) {\n            return serverError(poError?.message || 'Failed to create PO');\n        }\n\n        // 6. Create PO Items\n        const poItems = requisition.items.map((item: any) => ({\n            purchase_order_id: po.id,\n            requisition_item_id: item.id,\n            description: item.description,\n            quantity_ordered: item.quantity,\n            unit_price: item.estimated_unit_price || 0,\n            line_total: item.estimated_total || 0,\n            unit_of_measure: item.unit_of_measure,\n            position: item.position,\n            notes: item.notes\n        }));\n\n        const { error: itemsError } = await supabase\n            .from('purchase_order_items')\n            .insert(poItems);\n\n        if (itemsError) {\n            // Rollback PO if items fail (manually since no transactions in simple client)\n            await supabase.from('purchase_orders').delete().eq('id', po.id);\n            return supabaseError(itemsError);\n        }\n\n        // 7. Update requisition status\n        await supabase\n            .from('purchase_requisitions')\n            .update({ status: 'ordered' })\n            .eq('id', id);\n\n        // 8. Audit Log\n        await supabase\n            .from('audit_logs')\n            .insert({\n                organization_id: requisition.organization_id,\n                user_id: user.id,\n                action: 'requisition_converted',\n                entity_type: 'purchase_requisition',\n                entity_id: id,\n                new_values: { po_id: po.id, po_number: poNumber },\n            });\n\n        return apiSuccess(po, { message: `Requisition converted to PO ${poNumber}` });\n    } catch (e) {\n        console.error('[API] Requisition convert error:', e);\n        return serverError('Conversion failed');\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/tasks/[id]/status/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":43,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1450,1453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1450,1453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, badRequest, notFound, supabaseError, serverError } from '@/lib/api/response';\n\n/**\n * POST /api/tasks/[id]/status\n * Update task status with dependency validation\n */\nexport async function POST(\n    request: NextRequest,\n    { params }: { params: Promise<{ id: string }> }\n) {\n    const { id } = await params;\n\n    try {\n        const auth = await requireAuth();\n        if (auth.error) return auth.error;\n        const { user, supabase } = auth;\n\n        const body = await request.json();\n        const { status: targetStatus, notes } = body;\n\n        if (!targetStatus) {\n            return badRequest('Target status is required');\n        }\n\n        // Get current task and its dependencies\n        // Assuming task_dependencies table exists with (task_id, depends_on_task_id)\n        const { data: task, error: fetchError } = await supabase\n            .from('tasks')\n            .select('*, dependencies:task_dependencies(depends_on_task_id)')\n            .eq('id', id)\n            .single();\n\n        if (fetchError || !task) {\n            return notFound('Task');\n        }\n\n        const currentStatus = task.status;\n\n        // Dependency Enforcement: Cannot move to in_progress/done if dependencies are not done\n        if (['in_progress', 'done'].includes(targetStatus)) {\n            const depIds = task.dependencies?.map((d: any) => d.depends_on_task_id) || [];\n            if (depIds.length > 0) {\n                const { data: openDeps, error: depError } = await supabase\n                    .from('tasks')\n                    .select('id, name, status')\n                    .in('id', depIds)\n                    .neq('status', 'done');\n\n                if (depError) {\n                    return serverError('Failed to check dependencies');\n                }\n\n                if (openDeps && openDeps.length > 0) {\n                    return badRequest('Task is blocked by unfinished dependencies', { blocked_by: openDeps });\n                }\n            }\n        }\n\n        // Update task status\n        const { data, error } = await supabase\n            .from('tasks')\n            .update({\n                status: targetStatus,\n                completed_at: targetStatus === 'done' ? new Date().toISOString() : task.completed_at,\n                updated_at: new Date().toISOString()\n            })\n            .eq('id', id)\n            .select()\n            .single();\n\n        if (error) {\n            return supabaseError(error);\n        }\n\n        // Audit Log\n        await supabase\n            .from('audit_logs')\n            .insert({\n                organization_id: task.organization_id,\n                user_id: user.id,\n                action: 'task_status_changed',\n                entity_type: 'task',\n                entity_id: id,\n                old_values: { status: currentStatus },\n                new_values: { status: targetStatus, notes: notes || null },\n            });\n\n        return apiSuccess(data, { message: `Task status updated to ${targetStatus}` });\n    } catch (e) {\n        console.error('[API] Task status update error:', e);\n        return serverError('Failed to update task status');\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/app/api/timesheets/[id]/submit/route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2296,2299],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2296,2299],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":145,"column":15,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":18,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4956,4959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4956,4959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextRequest } from 'next/server';\nimport { requireAuth } from '@/lib/api/guard';\nimport { apiSuccess, badRequest, notFound, supabaseError, serverError } from '@/lib/api/response';\n\n/**\n * POST /api/timesheets/[id]/submit\n * Submit a timesheet for approval - integrates with approval workflow system\n */\nexport async function POST(\n    request: NextRequest,\n    { params }: { params: Promise<{ id: string }> }\n) {\n    const { id } = await params;\n\n    try {\n        const auth = await requireAuth();\n        if (auth.error) return auth.error;\n        const { user, supabase } = auth;\n\n        // Get the timesheet\n        const { data: timesheet, error: fetchError } = await supabase\n            .from('timesheets')\n            .select('*')\n            .eq('id', id)\n            .single();\n\n        if (fetchError || !timesheet) {\n            return notFound('Timesheet');\n        }\n\n        // Validate status allows submission\n        if (timesheet.status !== 'draft') {\n            return badRequest(`Timesheet with status '${timesheet.status}' cannot be submitted`);\n        }\n\n        // Validate timesheet has entries\n        const { count: entryCount } = await supabase\n            .from('timesheet_entries')\n            .select('*', { count: 'exact', head: true })\n            .eq('timesheet_id', id);\n\n        if (!entryCount || entryCount === 0) {\n            return badRequest('Cannot submit empty timesheet');\n        }\n\n        // Update timesheet status\n        const { data: updatedTimesheet, error: updateError } = await supabase\n            .from('timesheets')\n            .update({\n                status: 'submitted',\n                submitted_at: new Date().toISOString(),\n                updated_at: new Date().toISOString(),\n            })\n            .eq('id', id)\n            .select()\n            .single();\n\n        if (updateError) {\n            return supabaseError(updateError);\n        }\n\n        // Find applicable approval workflow for timesheets\n        const { data: workflow } = await supabase\n            .from('approval_workflows')\n            .select('*')\n            .eq('organization_id', timesheet.organization_id)\n            .eq('entity_type', 'timesheet')\n            .eq('is_active', true)\n            .single();\n\n        let approvalRequest: any = null;\n\n        if (workflow) {\n            // Create approval request\n            const { data: request, error: approvalError } = await supabase\n                .from('approval_requests')\n                .insert({\n                    organization_id: timesheet.organization_id,\n                    approval_workflow_id: workflow.id,\n                    entity_type: 'timesheet',\n                    entity_id: id,\n                    status: 'pending',\n                    requested_by: user.id,\n                    requested_at: new Date().toISOString(),\n                    current_step: 1,\n                    total_steps: workflow.config?.steps?.length || 1,\n                })\n                .select()\n                .single();\n\n            if (!approvalError) {\n                approvalRequest = request;\n            }\n\n            // Notify approvers based on workflow type\n            const approvers = await getApprovers(supabase, workflow, timesheet);\n\n            if (approvers.length > 0) {\n                const notifications = approvers.map(approverId => ({\n                    organization_id: timesheet.organization_id,\n                    user_id: approverId,\n                    type: 'timesheet_pending_approval',\n                    title: 'Timesheet Pending Approval',\n                    message: `A timesheet requires your approval`,\n                    data: {\n                        timesheet_id: id,\n                        approval_request_id: approvalRequest?.id,\n                    },\n                    entity_type: 'timesheet',\n                    entity_id: id,\n                }));\n\n                await supabase.from('notifications').insert(notifications);\n            }\n        }\n\n        // Create audit log\n        await supabase\n            .from('audit_logs')\n            .insert({\n                organization_id: timesheet.organization_id,\n                user_id: user.id,\n                action: 'timesheet_submitted',\n                entity_type: 'timesheet',\n                entity_id: id,\n                old_values: { status: 'draft' },\n                new_values: { status: 'submitted' },\n            });\n\n        return apiSuccess(updatedTimesheet, {\n            approval_request: approvalRequest,\n            message: 'Timesheet submitted for approval',\n        });\n    } catch (e) {\n        console.error('[API] Timesheet submit error:', e);\n        return serverError('Submission failed');\n    }\n}\n\n/**\n * Helper to get approvers based on workflow configuration\n */\n// eslint-disable-next-line @typescript-eslint/no-explicit-any -- Supabase client type\nasync function getApprovers(\n    supabase: any,\n    workflow: { approval_type: string; config: Record<string, unknown> },\n    timesheet: { organization_id: string; user_id: string }\n): Promise<string[]> {\n    const approvers: string[] = [];\n\n    switch (workflow.approval_type) {\n        case 'manager_hierarchy':\n            // Get the employee's manager\n            const { data: member } = await supabase\n                .from('organization_members')\n                .select('department_id')\n                .eq('user_id', timesheet.user_id)\n                .eq('organization_id', timesheet.organization_id)\n                .single();\n\n            if (member?.department_id) {\n                const { data: dept } = await supabase\n                    .from('departments')\n                    .select('manager_id')\n                    .eq('id', member.department_id)\n                    .single();\n\n                if (dept?.manager_id) {\n                    approvers.push(dept.manager_id);\n                }\n            }\n            break;\n\n        case 'role_based':\n            // Get users with specific role\n            const roleId = (workflow.config as { approver_role_id?: string })?.approver_role_id;\n            if (roleId) {\n                const { data: roleMembers } = await supabase\n                    .from('organization_members')\n                    .select('user_id')\n                    .eq('organization_id', timesheet.organization_id)\n                    .eq('role_id', roleId);\n\n                if (roleMembers) {\n                    approvers.push(...roleMembers.map((m: { user_id: string }) => m.user_id));\n                }\n            }\n            break;\n\n        case 'single_approver':\n            const approverId = (workflow.config as { approver_id?: string })?.approver_id;\n            if (approverId) {\n                approvers.push(approverId);\n            }\n            break;\n    }\n\n    return approvers;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/modules/business/PipelineBoard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":227,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":227,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8316,8319],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8316,8319],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":230,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":230,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8423,8426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8423,8426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":231,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8492,8495],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8492,8495],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":265,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":265,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9591,9594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9591,9594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":293,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":293,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10450,10453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10450,10453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":317,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":317,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11389,11392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11389,11392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":36,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[977,980],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[977,980],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React, { useMemo, useState } from 'react';\nimport {\n    DndContext,\n    DragOverlay,\n    closestCorners,\n    KeyboardSensor,\n    PointerSensor,\n    useSensor,\n    useSensors,\n    DragStartEvent,\n    DragEndEvent,\n    defaultDropAnimationSideEffects,\n    DropAnimation\n} from '@dnd-kit/core';\nimport {\n    SortableContext,\n    sortableKeyboardCoordinates,\n    verticalListSortingStrategy,\n    useSortable\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\nimport { createPortal } from 'react-dom';\n\nimport { useCrud } from '@/lib/crud/hooks/useCrud';\nimport { dealSchema } from '@/lib/schemas/deal';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { cn } from '@/lib/utils';\nimport { DEFAULT_LOCALE } from '@/lib/config';\nimport { ScrollArea } from '@/components/ui/scroll-area';\n\n// --- Types ---\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype Deal = any;\n\n// --- Utilities ---\nconst currencyFormatter = new Intl.NumberFormat(DEFAULT_LOCALE, {\n    style: 'currency',\n    currency: 'USD',\n    maximumFractionDigits: 0,\n});\n\nconst DEFAULT_ROTTING_DAYS = 7;\n\nfunction getDaysSinceActivity(lastActivityAt: string | Date | null | undefined): number {\n    if (!lastActivityAt) return Infinity;\n    const lastActivity = new Date(lastActivityAt);\n    const now = new Date();\n    const diffMs = now.getTime() - lastActivity.getTime();\n    return Math.floor(diffMs / (1000 * 60 * 60 * 24));\n}\n\nfunction isDeadRotting(deal: Deal, rottingDays: number = DEFAULT_ROTTING_DAYS): boolean {\n    if (deal.stage === 'closed-won' || deal.stage === 'closed-lost') return false;\n    const daysSince = getDaysSinceActivity(deal.lastActivityAt || deal.last_activity_at);\n    return daysSince > rottingDays;\n}\n\n// --- Components ---\n\nfunction SortableDealCard({ deal, isOverlay }: { deal: Deal; isOverlay?: boolean }) {\n    const {\n        setNodeRef,\n        attributes,\n        listeners,\n        transform,\n        transition,\n        isDragging,\n    } = useSortable({\n        id: deal.id,\n        data: {\n            type: 'Deal',\n            deal,\n        },\n    });\n\n    const style = {\n        transition,\n        transform: CSS.Translate.toString(transform),\n    };\n\n    const variants = {\n        prospecting: 'border-l-muted-foreground',\n        qualification: 'border-l-semantic-info',\n        proposal: 'border-l-semantic-warning',\n        negotiation: 'border-l-semantic-orange',\n        'closed-won': 'border-l-semantic-success',\n        'closed-lost': 'border-l-destructive',\n    };\n\n    const isRotting = isDeadRotting(deal);\n    const daysSinceActivity = getDaysSinceActivity(deal.lastActivityAt || deal.last_activity_at);\n\n    return (\n        <Card\n            ref={setNodeRef}\n            style={style}\n            {...attributes}\n            {...listeners}\n            className={cn(\n                \"mb-3 cursor-grab hover:shadow-md transition-all border-l-4\",\n                variants[deal.stage as keyof typeof variants] || 'border-l-border',\n                isDragging && \"opacity-30\",\n                isOverlay && \"shadow-xl rotate-2 cursor-grabbing opacity-90 scale-105 z-50 ring-2 ring-primary\",\n                isRotting && \"ring-2 ring-destructive/50 bg-destructive/5/30 dark:bg-destructive/90/20\"\n            )}\n        >\n            <CardContent className=\"p-3\">\n                {isRotting && (\n                    <div className=\"flex items-center gap-1.5 mb-2 text-destructive dark:text-destructive/80\">\n                        <svg className=\"w-3.5 h-3.5\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495zM10 5a.75.75 0 01.75.75v3.5a.75.75 0 01-1.5 0v-3.5A.75.75 0 0110 5zm0 9a1 1 0 100-2 1 1 0 000 2z\" clipRule=\"evenodd\" />\n                        </svg>\n                        <span className=\"text-[10px] font-semibold uppercase tracking-wider\">\n                            {daysSinceActivity === Infinity ? 'No activity' : `${daysSinceActivity}d idle`}\n                        </span>\n                    </div>\n                )}\n                <div className=\"flex justify-between items-start mb-2\">\n                    <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider\">\n                        {deal.companyId || 'Unknown Co.'}\n                    </span>\n                    {deal.probability && (\n                        <Badge variant=\"secondary\" className=\"text-[10px] h-5 px-1\">\n                            {deal.probability}%\n                        </Badge>\n                    )}\n                </div>\n                <h4 className=\"font-medium text-sm mb-1 line-clamp-2\">{deal.name}</h4>\n                <div className=\"flex justify-between items-center mt-3\">\n                    <span className=\"font-bold text-sm\">\n                        {currencyFormatter.format(Number(deal.value) || 0)}\n                    </span>\n                    <span className=\"text-xs text-muted-foreground\">\n                        {deal.closeDate ? new Date(deal.closeDate).toLocaleDateString() : 'No date'}\n                    </span>\n                </div>\n            </CardContent>\n        </Card>\n    );\n}\n\nfunction PipelineColumn({\n    id,\n    title,\n    deals,\n    color\n}: {\n    id: string,\n    title: string,\n    deals: Deal[],\n    color: string\n}) {\n    const { setNodeRef } = useSortable({\n        id: id,\n        data: {\n            type: 'Column',\n            columnId: id,\n        },\n        disabled: true, // Columns aren't draggable themselves in this version\n    });\n\n    const totalValue = deals.reduce((sum, d) => sum + (Number(d.value) || 0), 0);\n\n    return (\n        <div ref={setNodeRef} className=\"flex flex-col h-full min-w-[280px] max-w-[320px] rounded-lg bg-muted/30 border border-border/50\">\n            <div className={cn(\"p-3 border-b flex justify-between items-center bg-muted/40 rounded-t-lg\")}>\n                <div className=\"flex items-center gap-2\">\n                    <div className={cn(\"w-3 h-3 rounded-full\", color)} />\n                    <h3 className=\"font-semibold text-sm\">{title}</h3>\n                    <Badge variant=\"outline\" className=\"text-[10px] h-5 bg-background\">{deals.length}</Badge>\n                </div>\n                <span className=\"text-xs font-mono text-muted-foreground\">\n                    {currencyFormatter.format(totalValue)}\n                </span>\n            </div>\n\n            <ScrollArea className=\"flex-1 p-2\">\n                <div className=\"flex flex-col min-h-[150px]\">\n                    <SortableContext items={deals.map(d => d.id)} strategy={verticalListSortingStrategy}>\n                        {deals.map((deal) => (\n                            <SortableDealCard key={deal.id} deal={deal} />\n                        ))}\n                    </SortableContext>\n                </div>\n            </ScrollArea>\n        </div>\n    );\n}\n\ninterface PipelineBoardProps {\n    pipelineId?: string;\n}\n\nexport function PipelineBoard({ pipelineId }: PipelineBoardProps) {\n    const { data: deals, update, loading } = useCrud(dealSchema, {\n        query: pipelineId ? { where: { pipeline_id: pipelineId } } : undefined,\n    });\n    const [activeDeal, setActiveDeal] = useState<Deal | null>(null);\n\n    // Define columns based on schema options\n    const columns = useMemo(() => {\n        const rawOptions = dealSchema.data.fields.stage.options;\n        // Handle the case where options might be a function or undefined, though we know it's an array for deals\n        if (Array.isArray(rawOptions)) {\n            return rawOptions as { label: string; value: string; color?: string }[];\n        }\n        return [];\n    }, []);\n\n    const sensors = useSensors(\n        useSensor(PointerSensor, {\n            activationConstraint: {\n                distance: 5, // Prevent accidental drags\n            },\n        }),\n        useSensor(KeyboardSensor, {\n            coordinateGetter: sortableKeyboardCoordinates,\n        })\n    );\n\n    // Group deals by stage\n    const dealsByStage = useMemo(() => {\n        const groups: Record<string, Deal[]> = {};\n        columns.forEach((col: any) => { groups[col.value] = [] });\n\n        if (Array.isArray(deals)) {\n            deals.forEach((deal: any) => {\n                const stage = deal.stage || (columns[0] as any)?.value;\n                if (groups[stage]) {\n                    groups[stage].push(deal);\n                } else {\n                    // Handle unknown stages by putting in first col or 'prospecting'\n                    if (!groups['prospecting']) groups['prospecting'] = [];\n                    groups['prospecting'].push(deal);\n                }\n            });\n        }\n        return groups;\n    }, [deals, columns]);\n\n    const onDragStart = (event: DragStartEvent) => {\n        if (event.active.data.current?.type === 'Deal') {\n            setActiveDeal(event.active.data.current.deal);\n        }\n    };\n\n    const onDragEnd = (event: DragEndEvent) => {\n        const { active, over } = event;\n        setActiveDeal(null);\n\n        if (!over) return;\n\n        const activeId = active.id;\n        const overId = over.id;\n\n        // Find the container (column) we dropped into\n        // If over a deal, find that deal's stage. If over a column, use column id.\n\n        let newStage = '';\n\n        // Check if we dropped directly on a column\n        const overColumn = columns.find((c: any) => c.value === overId);\n        if (overColumn) {\n            newStage = overColumn.value;\n        } else {\n            // We dropped on a card, find its deal to get the stage\n            const overDeal = deals.find((d: Deal) => d.id === overId);\n            if (overDeal) {\n                newStage = overDeal.stage;\n            }\n        }\n\n        if (newStage && activeDeal && activeDeal.stage !== newStage) {\n            // Update the deal stage\n            update(String(activeId), { stage: newStage });\n        }\n    };\n\n    const dropAnimation: DropAnimation = {\n        sideEffects: defaultDropAnimationSideEffects({\n            styles: {\n                active: {\n                    opacity: '0.5',\n                },\n            },\n        }),\n    };\n\n    const getColorForStage = (stage: string) => {\n        const option = columns.find((c: any) => c.value === stage);\n        const colorMap: Record<string, string> = {\n            gray: 'bg-muted-foreground',\n            blue: 'bg-semantic-info',\n            yellow: 'bg-semantic-warning',\n            orange: 'bg-semantic-orange',\n            green: 'bg-semantic-success',\n            red: 'bg-destructive'\n        };\n        return colorMap[option?.color || 'gray'] || 'bg-muted-foreground';\n    };\n\n    if (loading) {\n        return <div className=\"flex h-full items-center justify-center p-10\"><div className=\"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full\" /></div>;\n    }\n\n    return (\n        <DndContext\n            sensors={sensors}\n            collisionDetection={closestCorners}\n            onDragStart={onDragStart}\n            onDragEnd={onDragEnd}\n        >\n            <div className=\"flex h-[calc(100vh-140px)] gap-4 overflow-x-auto pb-4 px-1\">\n                {columns.map((col: any) => (\n                    <PipelineColumn\n                        key={col.value}\n                        id={col.value}\n                        title={col.label}\n                        deals={dealsByStage[col.value] || []}\n                        color={getColorForStage(col.value)}\n                    />\n                ))}\n            </div>\n\n            {createPortal(\n                <DragOverlay dropAnimation={dropAnimation}>\n                    {activeDeal ? (\n                        <SortableDealCard deal={activeDeal} isOverlay />\n                    ) : null}\n                </DragOverlay>,\n                document.body\n            )}\n        </DndContext>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/modules/business/PipelineSelector.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"The 'pipelines' logical expression could make the dependencies of useEffect Hook (at line 60) change on every render. To fix this, wrap the initialization of 'pipelines' in its own useMemo() Hook.","line":50,"column":11,"nodeType":"VariableDeclarator","endLine":50,"endColumn":54}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport React from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from '@/components/ui/select';\nimport { Button } from '@/components/ui/button';\nimport { Plus, Settings } from 'lucide-react';\nimport { Skeleton } from '@/components/ui/skeleton';\n\ninterface Pipeline {\n    id: string;\n    name: string;\n    description?: string;\n    pipeline_type: string;\n    is_default: boolean;\n    is_active: boolean;\n    deal_count?: number;\n}\n\ninterface PipelineSelectorProps {\n    selectedPipelineId?: string;\n    onPipelineChange: (pipelineId: string) => void;\n    onCreatePipeline?: () => void;\n    onManagePipelines?: () => void;\n    showActions?: boolean;\n}\n\nexport function PipelineSelector({\n    selectedPipelineId,\n    onPipelineChange,\n    onCreatePipeline,\n    onManagePipelines,\n    showActions = true,\n}: PipelineSelectorProps) {\n    const { data, isLoading } = useQuery({\n        queryKey: ['pipelines'],\n        queryFn: async () => {\n            const res = await fetch('/api/pipelines?is_active=true');\n            if (!res.ok) throw new Error('Failed to load pipelines');\n            return res.json();\n        },\n    });\n\n    const pipelines: Pipeline[] = data?.records || [];\n\n    // Auto-select default pipeline if none selected\n    React.useEffect(() => {\n        if (!selectedPipelineId && pipelines.length > 0) {\n            const defaultPipeline = pipelines.find(p => p.is_default) || pipelines[0];\n            if (defaultPipeline) {\n                onPipelineChange(defaultPipeline.id);\n            }\n        }\n    }, [pipelines, selectedPipelineId, onPipelineChange]);\n\n    if (isLoading) {\n        return <Skeleton className=\"h-9 w-48\" />;\n    }\n\n    if (pipelines.length === 0) {\n        return (\n            <Button variant=\"outline\" size=\"sm\" onClick={onCreatePipeline}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Create Pipeline\n            </Button>\n        );\n    }\n\n    // If only one pipeline, show it as a label instead of dropdown\n    if (pipelines.length === 1) {\n        return (\n            <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-medium\">{pipelines[0].name}</span>\n                {showActions && onManagePipelines && (\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={onManagePipelines}>\n                        <Settings className=\"h-3.5 w-3.5\" />\n                    </Button>\n                )}\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex items-center gap-2\">\n            <Select value={selectedPipelineId} onValueChange={onPipelineChange}>\n                <SelectTrigger className=\"w-48 h-9\">\n                    <SelectValue placeholder=\"Select pipeline\" />\n                </SelectTrigger>\n                <SelectContent>\n                    {pipelines.map(pipeline => (\n                        <SelectItem key={pipeline.id} value={pipeline.id}>\n                            <div className=\"flex items-center justify-between w-full\">\n                                <span>{pipeline.name}</span>\n                                {pipeline.deal_count !== undefined && (\n                                    <span className=\"text-xs text-muted-foreground ml-2\">\n                                        ({pipeline.deal_count})\n                                    </span>\n                                )}\n                            </div>\n                        </SelectItem>\n                    ))}\n                </SelectContent>\n            </Select>\n\n            {showActions && (\n                <div className=\"flex items-center gap-1\">\n                    {onCreatePipeline && (\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={onCreatePipeline}>\n                            <Plus className=\"h-3.5 w-3.5\" />\n                        </Button>\n                    )}\n                    {onManagePipelines && (\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={onManagePipelines}>\n                            <Settings className=\"h-3.5 w-3.5\" />\n                        </Button>\n                    )}\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport default PipelineSelector;\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/onboarding/AccountTypeSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":63,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2490,2493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2490,2493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Label } from '@/components/ui/label';\nimport { Badge } from '@/components/ui/badge';\nimport { useLookupTables } from '@/hooks/use-configuration';\n\ninterface AccountTypeSelectorProps {\n  user?: { user_metadata?: Record<string, unknown> } | null;\n  onNext?: (data: { accountType: string }) => void;\n}\n\nexport function AccountTypeSelector({ onNext }: AccountTypeSelectorProps) {\n  const [selectedType, setSelectedType] = useState<string>('');\n  const { data: accountTypes, isLoading } = useLookupTables('account_types');\n\n  const handleContinue = () => {\n    if (selectedType && onNext) {\n      onNext({ accountType: selectedType });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"max-w-2xl mx-auto\">\n        <CardContent className=\"p-6\">\n          <div className=\"animate-pulse space-y-4\">\n            <div className=\"h-6 bg-gray-200 rounded w-1/2 mx-auto\"></div>\n            <div className=\"space-y-3\">\n              {[1, 2, 3].map(i => (\n                <div key={i} className=\"h-20 bg-gray-200 rounded\"></div>\n              ))}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const activeAccountTypes = accountTypes?.filter(type => type.is_active) || [];\n\n  return (\n    <Card className=\"max-w-2xl mx-auto\">\n      <CardHeader className=\"text-center\">\n        <CardTitle className=\"text-2xl\">Select Your Account Type</CardTitle>\n        <p className=\"text-muted-foreground\">\n          Choose the account type that best describes your role and needs.\n        </p>\n      </CardHeader>\n      <CardContent>\n        <RadioGroup value={selectedType} onValueChange={setSelectedType} className=\"space-y-4\">\n          {activeAccountTypes.map((type) => (\n            <div key={type.key} className=\"flex items-center space-x-3 p-4 border rounded-lg hover:bg-accent\">\n              <RadioGroupItem value={type.key} id={type.key} />\n              <Label htmlFor={type.key} className=\"flex-1 cursor-pointer\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h3 className=\"font-semibold\">{type.value}</h3>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {(type.metadata as any)?.description || 'Configure your account for this role'}\n                    </p>\n                  </div>\n                  <Badge variant=\"outline\" className=\"ml-2\">\n                    {type.key}\n                  </Badge>\n                </div>\n              </Label>\n            </div>\n          ))}\n        </RadioGroup>\n\n        <Button\n          onClick={handleContinue}\n          disabled={!selectedType}\n          className=\"w-full mt-6\"\n          size=\"lg\"\n        >\n          Continue\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/people/LifeStreamProfile.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":10,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[528,531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[528,531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'person' is defined but never used. Allowed unused args must match /^_/u.","line":55,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":55,"endColumn":43,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar } from 'recharts';\nimport { Timeline, TimelineItem, TimelineDot, TimelineContent, TimelineHeader, TimelineTitle, TimelineDescription, TimelineTime } from '@/components/ui/timeline';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Trophy, Award, Briefcase, Star } from 'lucide-react';\n\ninterface LifeStreamProfileProps {\n    person: any; // Using any for flexibility with schema, ideally strictly typed\n}\n\n// Mock data for visualizations\nconst SKILL_DATA = [\n    { subject: 'Strategy', A: 120, fullMark: 150 },\n    { subject: 'Leadership', A: 98, fullMark: 150 },\n    { subject: 'Technical', A: 86, fullMark: 150 },\n    { subject: 'Culture', A: 99, fullMark: 150 },\n    { subject: 'Communication', A: 85, fullMark: 150 },\n    { subject: 'Execution', A: 65, fullMark: 150 },\n];\n\nconst TIMELINE_EVENTS = [\n    {\n        title: 'Promoted to Senior Manager',\n        time: '2 days ago',\n        description: 'Advanced due to exceptional performance in Q1.',\n        icon: Star,\n        color: 'warning' as const\n    },\n    {\n        title: 'Completed \"Safety First\" Certification',\n        time: '1 week ago',\n        description: 'Mandatory annual safety refresher.',\n        icon: Award,\n        color: 'success' as const\n    },\n    {\n        title: 'Joined \"Alpha\" Project Team',\n        time: '1 month ago',\n        description: 'Assigned as lead technical resource.',\n        icon: Briefcase,\n        color: 'default' as const\n    },\n    {\n        title: 'Hired at ATLVS',\n        time: '6 months ago',\n        description: 'Started journey in the Engineering department.',\n        icon: Trophy,\n        color: 'outline' as const\n    },\n];\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function LifeStreamProfile({ person }: LifeStreamProfileProps) {\n    return (\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full\">\n\n            {/* Col 1: Skill DNA (Spider Chart) */}\n            <Card className=\"col-span-1 bg-card/80 border-border backdrop-blur-xl\">\n                <CardHeader>\n                    <CardTitle className=\"text-lg text-foreground\">Skill DNA</CardTitle>\n                </CardHeader>\n                <CardContent className=\"h-[300px] w-full\">\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\n                        <RadarChart cx=\"50%\" cy=\"50%\" outerRadius=\"80%\" data={SKILL_DATA}>\n                            <PolarGrid stroke=\"hsl(var(--chart-tooltip-border))\" />\n                            <PolarAngleAxis dataKey=\"subject\" tick={{ fill: 'hsl(var(--chart-axis))', fontSize: 12 }} />\n                            <PolarRadiusAxis angle={30} domain={[0, 150]} tick={false} axisLine={false} />\n                            <Radar\n                                name=\"Skills\"\n                                dataKey=\"A\"\n                                stroke=\"hsl(var(--chart-income))\"\n                                strokeWidth={2}\n                                fill=\"hsl(var(--chart-income))\"\n                                fillOpacity={0.3}\n                            />\n                        </RadarChart>\n                    </ResponsiveContainer>\n                </CardContent>\n            </Card>\n\n            {/* Col 2 & 3: Life Stream (Timeline) */}\n            <Card className=\"col-span-1 lg:col-span-2 bg-card/80 border-border backdrop-blur-xl\">\n                <CardHeader>\n                    <CardTitle className=\"text-lg text-foreground flex items-center gap-2\">\n                        Life Stream\n                        <Badge variant=\"outline\" className=\"ml-2 text-xs font-normal text-muted-foreground border-border\">Recent Activity</Badge>\n                    </CardTitle>\n                </CardHeader>\n                <CardContent>\n                    <Timeline>\n                        {TIMELINE_EVENTS.map((item, idx) => (\n                            <TimelineItem key={idx}>\n                                <TimelineDot variant={item.color}>\n                                    <item.icon className=\"h-3 w-3 text-white\" />\n                                </TimelineDot>\n                                <TimelineContent>\n                                    <TimelineHeader>\n                                        <TimelineTitle>{item.title}</TimelineTitle>\n                                        <TimelineTime>{item.time}</TimelineTime>\n                                    </TimelineHeader>\n                                    <TimelineDescription>{item.description}</TimelineDescription>\n                                </TimelineContent>\n                            </TimelineItem>\n                        ))}\n                    </Timeline>\n                </CardContent>\n            </Card>\n\n        </div>\n    );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/templates/WizardTemplate.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":16,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[506,509],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[506,509],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":18,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":18,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[558,561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[558,561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":31,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[873,876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[873,876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":38,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1095,1098],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1095,1098],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport React, { useState } from 'react';\nimport { PageLayoutRenderer } from '../ComponentRegistry';\nimport { useUser } from '@/hooks/use-supabase';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\n\ninterface WizardTemplateProps {\n  layoutSlug?: string;\n  title?: string;\n  steps?: Array<{\n    title: string;\n    component: string;\n    data?: Record<string, any>;\n  }>;\n  onComplete?: (allData: Record<string, any>) => void;\n  className?: string;\n}\n\nexport function WizardTemplate({\n  layoutSlug,\n  title,\n  steps: customSteps,\n  onComplete,\n  className\n}: WizardTemplateProps) {\n  const { user } = useUser();\n  const [currentStep, setCurrentStep] = useState(0);\n  const [wizardData, setWizardData] = useState<Record<string, any>>({});\n\n  // Use custom steps or get from layout\n  const steps = customSteps || [];\n\n  const progress = steps.length > 0 ? ((currentStep + 1) / steps.length) * 100 : 0;\n\n  const handleNext = (stepData?: Record<string, any>) => {\n    if (stepData) {\n      setWizardData(prev => ({ ...prev, ...stepData }));\n    }\n\n    if (currentStep < steps.length - 1) {\n      setCurrentStep(prev => prev + 1);\n    } else {\n      // Complete wizard\n      const allData = { ...wizardData, ...(stepData || {}) };\n      onComplete?.(allData);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  const currentStepData = steps[currentStep];\n\n  if (!currentStepData) {\n    return (\n      <Card className={className}>\n        <CardContent className=\"p-6\">\n          <p className=\"text-center text-muted-foreground\">\n            No steps configured for this wizard.\n          </p>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const contextData = {\n    user,\n    title: title || currentStepData.title,\n    wizardData,\n    currentStep,\n    totalSteps: steps.length,\n    onNext: handleNext,\n    onPrevious: handlePrevious,\n    ...currentStepData.data\n  };\n\n  return (\n    <div className={className}>\n      {/* Progress Header */}\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center justify-between\">\n            <span>{title || 'Wizard'}</span>\n            <span className=\"text-sm font-normal\">\n              Step {currentStep + 1} of {steps.length}\n            </span>\n          </CardTitle>\n          <Progress value={progress} className=\"mt-2\" />\n        </CardHeader>\n      </Card>\n\n      {/* Current Step Content */}\n      <PageLayoutRenderer\n        layoutSlug={layoutSlug}\n        layoutType=\"wizard\"\n        contextData={contextData}\n      />\n\n      {/* Navigation Footer */}\n      <Card className=\"mt-6\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex justify-between\">\n            <Button\n              variant=\"outline\"\n              onClick={handlePrevious}\n              disabled={currentStep === 0}\n            >\n              Previous\n            </Button>\n            <Button\n              onClick={() => handleNext()}\n              disabled={currentStep >= steps.length - 1 && !onComplete}\n            >\n              {currentStep >= steps.length - 1 ? 'Complete' : 'Next'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/views/form-builder.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":271,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":271,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8470,8473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8470,8473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":272,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":272,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8544,8547],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8544,8547],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as React from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  GripVertical,\n  Plus,\n  Trash2,\n  Copy,\n  Settings,\n  Type,\n  Hash,\n  Calendar,\n  CheckSquare,\n  List,\n  FileText,\n  Mail,\n  Phone,\n  Link,\n  Upload,\n  ToggleLeft,\n  AlignLeft,\n} from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport type FieldType =\n  | \"text\"\n  | \"textarea\"\n  | \"number\"\n  | \"email\"\n  | \"phone\"\n  | \"url\"\n  | \"date\"\n  | \"datetime\"\n  | \"select\"\n  | \"multiselect\"\n  | \"checkbox\"\n  | \"radio\"\n  | \"toggle\"\n  | \"file\"\n  | \"heading\"\n  | \"paragraph\";\n\nexport interface FormFieldOption {\n  label: string;\n  value: string;\n}\n\nexport interface FormFieldCondition {\n  fieldId: string;\n  operator: \"equals\" | \"not_equals\" | \"contains\" | \"is_empty\" | \"is_not_empty\";\n  value?: string;\n}\n\nexport interface FormField {\n  id: string;\n  type: FieldType;\n  label: string;\n  placeholder?: string;\n  description?: string;\n  required?: boolean;\n  options?: FormFieldOption[];\n  validation?: {\n    min?: number;\n    max?: number;\n    pattern?: string;\n    message?: string;\n  };\n  conditions?: FormFieldCondition[];\n  defaultValue?: string | number | boolean;\n  width?: \"full\" | \"half\" | \"third\";\n}\n\nexport interface FormBuilderProps {\n  fields: FormField[];\n  onChange: (fields: FormField[]) => void;\n  title?: string;\n  description?: string;\n  className?: string;\n  readOnly?: boolean;\n}\n\nconst fieldTypeIcons: Record<FieldType, React.ReactNode> = {\n  text: <Type className=\"h-4 w-4\" />,\n  textarea: <AlignLeft className=\"h-4 w-4\" />,\n  number: <Hash className=\"h-4 w-4\" />,\n  email: <Mail className=\"h-4 w-4\" />,\n  phone: <Phone className=\"h-4 w-4\" />,\n  url: <Link className=\"h-4 w-4\" />,\n  date: <Calendar className=\"h-4 w-4\" />,\n  datetime: <Calendar className=\"h-4 w-4\" />,\n  select: <List className=\"h-4 w-4\" />,\n  multiselect: <List className=\"h-4 w-4\" />,\n  checkbox: <CheckSquare className=\"h-4 w-4\" />,\n  radio: <CheckSquare className=\"h-4 w-4\" />,\n  toggle: <ToggleLeft className=\"h-4 w-4\" />,\n  file: <Upload className=\"h-4 w-4\" />,\n  heading: <Type className=\"h-4 w-4\" />,\n  paragraph: <FileText className=\"h-4 w-4\" />,\n};\n\nconst fieldTypeLabels: Record<FieldType, string> = {\n  text: \"Text Input\",\n  textarea: \"Text Area\",\n  number: \"Number\",\n  email: \"Email\",\n  phone: \"Phone\",\n  url: \"URL\",\n  date: \"Date\",\n  datetime: \"Date & Time\",\n  select: \"Dropdown\",\n  multiselect: \"Multi-Select\",\n  checkbox: \"Checkbox\",\n  radio: \"Radio Buttons\",\n  toggle: \"Toggle\",\n  file: \"File Upload\",\n  heading: \"Heading\",\n  paragraph: \"Paragraph\",\n};\n\nexport function FormBuilder({\n  fields,\n  onChange,\n  title = \"Form Builder\",\n  description,\n  className,\n  readOnly = false,\n}: FormBuilderProps) {\n  const [selectedFieldId, setSelectedFieldId] = React.useState<string | null>(null);\n  const [draggedFieldId, setDraggedFieldId] = React.useState<string | null>(null);\n\n  const selectedField = fields.find((f) => f.id === selectedFieldId);\n\n  const addField = (type: FieldType) => {\n    const newField: FormField = {\n      id: `field_${Date.now()}`,\n      type,\n      label: fieldTypeLabels[type],\n      required: false,\n      width: \"full\",\n    };\n\n    if (type === \"select\" || type === \"multiselect\" || type === \"radio\") {\n      newField.options = [\n        { label: \"Option 1\", value: \"option_1\" },\n        { label: \"Option 2\", value: \"option_2\" },\n      ];\n    }\n\n    onChange([...fields, newField]);\n    setSelectedFieldId(newField.id);\n  };\n\n  const updateField = (id: string, updates: Partial<FormField>) => {\n    onChange(fields.map((f) => (f.id === id ? { ...f, ...updates } : f)));\n  };\n\n  const deleteField = (id: string) => {\n    onChange(fields.filter((f) => f.id !== id));\n    if (selectedFieldId === id) {\n      setSelectedFieldId(null);\n    }\n  };\n\n  const duplicateField = (id: string) => {\n    const field = fields.find((f) => f.id === id);\n    if (field) {\n      const newField = { ...field, id: `field_${Date.now()}`, label: `${field.label} (Copy)` };\n      const index = fields.findIndex((f) => f.id === id);\n      const newFields = [...fields];\n      newFields.splice(index + 1, 0, newField);\n      onChange(newFields);\n    }\n  };\n\n  const handleDragStart = (e: React.DragEvent, id: string) => {\n    setDraggedFieldId(id);\n    e.dataTransfer.effectAllowed = \"move\";\n  };\n\n  const handleDragOver = (e: React.DragEvent, targetId: string) => {\n    e.preventDefault();\n    if (draggedFieldId && draggedFieldId !== targetId) {\n      const draggedIndex = fields.findIndex((f) => f.id === draggedFieldId);\n      const targetIndex = fields.findIndex((f) => f.id === targetId);\n      const newFields = [...fields];\n      const [removed] = newFields.splice(draggedIndex, 1);\n      newFields.splice(targetIndex, 0, removed);\n      onChange(newFields);\n    }\n  };\n\n  const handleDragEnd = () => {\n    setDraggedFieldId(null);\n  };\n\n  return (\n    <div className={cn(\"grid grid-cols-1 lg:grid-cols-4 gap-6\", className)}>\n      {/* Field Palette */}\n      <Card className=\"lg:col-span-1 border-border glass-morphism overflow-hidden shadow-xl h-fit sticky top-6\">\n        <CardHeader className=\"pb-4 border-b border-border bg-background/5\">\n          <CardTitle className=\"text-[10px] font-black uppercase tracking-[0.2em] opacity-60\">Add Fields</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-3\">\n          <div className=\"grid grid-cols-1 gap-2\">\n            {(Object.keys(fieldTypeLabels) as FieldType[]).map((type, idx) => (\n              <motion.div\n                key={type}\n                initial={{ opacity: 0, x: -10 }}\n                animate={{ opacity: 1, x: 0 }}\n                transition={{ delay: idx * 0.02 }}\n              >\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  className=\"w-full justify-start h-10 px-4 glass-morphism border-border hover:border-primary/30 hover:bg-primary/5 transition-all group\"\n                  onClick={() => addField(type)}\n                  disabled={readOnly}\n                >\n                  <span className=\"mr-3 text-primary/60 group-hover:text-primary group-hover:scale-110 transition-all\">{fieldTypeIcons[type]}</span>\n                  <span className=\"text-[10px] font-bold uppercase tracking-wider\">{fieldTypeLabels[type]}</span>\n                </Button>\n              </motion.div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Form Preview */}\n      <Card className=\"lg:col-span-2 border-border glass-morphism overflow-hidden shadow-2xl\">\n        <CardHeader className=\"pb-4 border-b border-border bg-background/5\">\n          <CardTitle className=\"text-xl font-black tracking-tight uppercase opacity-80\">{title}</CardTitle>\n          {description && <CardDescription className=\"text-[10px] font-bold uppercase opacity-30 mt-1 tracking-wider\">{description}</CardDescription>}\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          {fields.length === 0 ? (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              className=\"text-center py-20 text-muted-foreground border-2 border-dashed border-border rounded-3xl bg-muted/30\"\n            >\n              <Plus className=\"h-10 w-10 mx-auto mb-4 opacity-20\" />\n              <p className=\"text-[11px] font-black uppercase tracking-widest opacity-40\">Add fields from the palette</p>\n            </motion.div>\n          ) : (\n            <div className=\"space-y-4\">\n              <AnimatePresence mode=\"popLayout\">\n                {fields.map((field) => (\n                  <motion.div\n                    key={field.id}\n                    layout\n                    initial={{ opacity: 0, y: 10 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, scale: 0.95 }}\n                    draggable={!readOnly}\n                    onDragStart={(e: any) => handleDragStart(e, field.id)}\n                    onDragOver={(e: any) => handleDragOver(e, field.id)}\n                    onDragEnd={handleDragEnd}\n                    className={cn(\n                      \"group relative p-5 border border-border rounded-2xl cursor-pointer transition-all duration-300\",\n                      selectedFieldId === field.id\n                        ? \"bg-primary/[0.03] border-primary/30 ring-1 ring-primary/20 shadow-[0_0_20px_rgba(var(--primary),0.05)]\"\n                        : \"hover:border-border hover:bg-accent/30\",\n                      draggedFieldId === field.id && \"opacity-50 scale-95\",\n                      field.width === \"half\" && \"w-[calc(50%-8px)] inline-block mr-4\",\n                      field.width === \"third\" && \"w-[calc(33.33%-11px)] inline-block mr-4\"\n                    )}\n                    onClick={() => setSelectedFieldId(field.id)}\n                  >\n                    {!readOnly && (\n                      <div className=\"absolute -left-3 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-all duration-300 cursor-grab p-1 hover:text-primary\">\n                        <GripVertical className=\"h-5 w-5\" />\n                      </div>\n                    )}\n\n                    <div className=\"flex items-center gap-3 mb-3\">\n                      <span className=\"text-primary/60 group-hover:scale-110 transition-transform\">{fieldTypeIcons[field.type]}</span>\n                      <Label className=\"text-[11px] font-black uppercase tracking-wider cursor-pointer\">\n                        {field.label}\n                        {field.required && <span className=\"text-destructive ml-1\">*</span>}\n                      </Label>\n                    </div>\n\n                    {field.type === \"heading\" ? (\n                      <h3 className=\"text-2xl font-black tracking-tight\">{field.label}</h3>\n                    ) : field.type === \"paragraph\" ? (\n                      <p className=\"text-sm font-medium text-muted-foreground opacity-60\">{field.description || \"Paragraph text\"}</p>\n                    ) : (\n                      <div className=\"glass-morphism bg-muted/30 border-border rounded-xl h-10 flex items-center px-4 opacity-40\">\n                        <span className=\"text-[10px] font-bold uppercase tracking-widest italic\">{field.placeholder || `Enter ${field.label.toLowerCase()}...`}</span>\n                      </div>\n                    )}\n\n                    {!readOnly && (\n                      <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-all duration-300 flex gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-7 w-7 hover:bg-accent rounded-full\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            duplicateField(field.id);\n                          }}\n                        >\n                          <Copy className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-7 w-7 text-destructive/80 hover:text-destructive hover:bg-destructive/10 rounded-full\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            deleteField(field.id);\n                          }}\n                        >\n                          <Trash2 className=\"h-3.5 w-3.5\" />\n                        </Button>\n                      </div>\n                    )}\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Field Settings */}\n      <Card className=\"lg:col-span-1 border-border glass-morphism overflow-hidden shadow-xl h-fit sticky top-6\">\n        <CardHeader className=\"pb-4 border-b border-border bg-background/5\">\n          <CardTitle className=\"text-[10px] font-black uppercase tracking-[0.2em] opacity-60 flex items-center gap-3\">\n            <Settings className=\"h-4 w-4 text-primary\" />\n            Field Settings\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          <AnimatePresence mode=\"wait\">\n            {selectedField ? (\n              <motion.div\n                key={selectedField.id}\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                className=\"space-y-6\"\n              >\n                <div className=\"space-y-3\">\n                  <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40\">Label</Label>\n                  <Input\n                    value={selectedField.label}\n                    onChange={(e) => updateField(selectedField.id, { label: e.target.value })}\n                    disabled={readOnly}\n                    className=\"h-9 glass-morphism border-border text-sm font-medium\"\n                  />\n                </div>\n\n                {selectedField.type !== \"heading\" && selectedField.type !== \"paragraph\" && (\n                  <>\n                    <div className=\"space-y-3\">\n                      <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40\">Placeholder</Label>\n                      <Input\n                        value={selectedField.placeholder || \"\"}\n                        onChange={(e) => updateField(selectedField.id, { placeholder: e.target.value })}\n                        disabled={readOnly}\n                        className=\"h-9 glass-morphism border-border text-sm font-medium\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40\">Description</Label>\n                      <Textarea\n                        value={selectedField.description || \"\"}\n                        onChange={(e) => updateField(selectedField.id, { description: e.target.value })}\n                        disabled={readOnly}\n                        className=\"min-h-[100px] glass-morphism border-border text-sm font-medium resize-none\"\n                      />\n                    </div>\n\n                    <div className=\"flex items-center justify-between p-3 rounded-xl bg-muted border border-border\">\n                      <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40 cursor-pointer\">Required Field</Label>\n                      <Switch\n                        checked={selectedField.required}\n                        onCheckedChange={(checked) => updateField(selectedField.id, { required: checked })}\n                        disabled={readOnly}\n                      />\n                    </div>\n\n                    <div className=\"space-y-3\">\n                      <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40\">Display Width</Label>\n                      <Select\n                        value={selectedField.width || \"full\"}\n                        onValueChange={(v) => updateField(selectedField.id, { width: v as FormField[\"width\"] })}\n                        disabled={readOnly}\n                      >\n                        <SelectTrigger className=\"h-9 glass-morphism border-border text-sm font-medium\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent className=\"glass-morphism border-border\">\n                          <SelectItem value=\"full\" className=\"text-xs font-bold uppercase\">Full Width (1/1)</SelectItem>\n                          <SelectItem value=\"half\" className=\"text-xs font-bold uppercase\">Half Width (1/2)</SelectItem>\n                          <SelectItem value=\"third\" className=\"text-xs font-bold uppercase\">Third Width (1/3)</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  </>\n                )}\n\n                {(selectedField.type === \"select\" ||\n                  selectedField.type === \"multiselect\" ||\n                  selectedField.type === \"radio\" ||\n                  selectedField.type === \"checkbox\") && (\n                    <div className=\"space-y-4\">\n                      <Label className=\"text-[10px] font-black uppercase tracking-widest opacity-40\">Options</Label>\n                      <div className=\"space-y-3\">\n                        <AnimatePresence mode=\"popLayout\">\n                          {selectedField.options?.map((opt, i) => (\n                            <motion.div\n                              key={i}\n                              initial={{ opacity: 0, scale: 0.9 }}\n                              animate={{ opacity: 1, scale: 1 }}\n                              exit={{ opacity: 0, scale: 0.9 }}\n                              className=\"flex gap-2\"\n                            >\n                              <Input\n                                value={opt.label}\n                                onChange={(e) => {\n                                  const newOptions = [...(selectedField.options || [])];\n                                  newOptions[i] = { ...opt, label: e.target.value, value: e.target.value.toLowerCase().replace(/\\s+/g, \"_\") };\n                                  updateField(selectedField.id, { options: newOptions });\n                                }}\n                                disabled={readOnly}\n                                className=\"h-9 glass-morphism border-border text-sm font-medium\"\n                              />\n                              {!readOnly && (\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  className=\"h-9 w-9 flex-shrink-0 hover:bg-destructive/10 text-destructive/80 rounded-full\"\n                                  onClick={() => {\n                                    const newOptions = selectedField.options?.filter((_, idx) => idx !== i);\n                                    updateField(selectedField.id, { options: newOptions });\n                                  }}\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              )}\n                            </motion.div>\n                          ))}\n                        </AnimatePresence>\n                        {!readOnly && (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            className=\"w-full glass-morphism border-border border-dashed hover:border-primary/50 text-[10px] font-black uppercase tracking-widest py-4\"\n                            onClick={() => {\n                              const newOptions = [\n                                ...(selectedField.options || []),\n                                { label: `Option ${(selectedField.options?.length || 0) + 1}`, value: `option_${(selectedField.options?.length || 0) + 1}` },\n                              ];\n                              updateField(selectedField.id, { options: newOptions });\n                            }}\n                          >\n                            <Plus className=\"h-3 w-3 mr-2\" />\n                            Add Option\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                <div className=\"pt-4 border-t border-border\">\n                  <Badge className=\"bg-primary/10 text-primary border-primary/20 text-[10px] font-black uppercase tracking-widest px-3 py-1\">\n                    {fieldTypeLabels[selectedField.type]}\n                  </Badge>\n                </div>\n              </motion.div>\n            ) : (\n              <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                className=\"text-center py-20 text-muted-foreground opacity-30\"\n              >\n                <Settings className=\"h-10 w-10 mx-auto mb-4 animate-[spin_10s_linear_infinite]\" />\n                <p className=\"text-[10px] font-black uppercase tracking-widest\">Select a field to configure</p>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\nexport interface FormRendererProps {\n  fields: FormField[];\n  values: Record<string, unknown>;\n  onChange: (values: Record<string, unknown>) => void;\n  onSubmit?: (values: Record<string, unknown>) => void;\n  errors?: Record<string, string>;\n  className?: string;\n}\n\nexport function FormRenderer({\n  fields,\n  values,\n  onChange,\n  onSubmit,\n  errors = {},\n  className,\n}: FormRendererProps) {\n  const updateValue = (fieldId: string, value: unknown) => {\n    onChange({ ...values, [fieldId]: value });\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onSubmit?.(values);\n  };\n\n  const isFieldVisible = (field: FormField): boolean => {\n    if (!field.conditions || field.conditions.length === 0) return true;\n\n    return field.conditions.every((condition) => {\n      const fieldValue = values[condition.fieldId];\n\n      switch (condition.operator) {\n        case \"equals\":\n          return fieldValue === condition.value;\n        case \"not_equals\":\n          return fieldValue !== condition.value;\n        case \"contains\":\n          return String(fieldValue || \"\").includes(condition.value || \"\");\n        case \"is_empty\":\n          return !fieldValue;\n        case \"is_not_empty\":\n          return !!fieldValue;\n        default:\n          return true;\n      }\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className={cn(\"space-y-4\", className)}>\n      {fields.filter(isFieldVisible).map((field) => (\n        <div\n          key={field.id}\n          className={cn(\n            field.width === \"half\" && \"w-1/2 inline-block pr-2\",\n            field.width === \"third\" && \"w-1/3 inline-block pr-2\"\n          )}\n        >\n          {field.type === \"heading\" ? (\n            <h3 className=\"text-lg font-semibold mt-4\">{field.label}</h3>\n          ) : field.type === \"paragraph\" ? (\n            <p className=\"text-sm text-muted-foreground\">{field.description}</p>\n          ) : (\n            <div className=\"space-y-2\">\n              <Label htmlFor={field.id}>\n                {field.label}\n                {field.required && <span className=\"text-destructive ml-1\">*</span>}\n              </Label>\n\n              {field.type === \"textarea\" ? (\n                <Textarea\n                  id={field.id}\n                  value={(values[field.id] as string) || \"\"}\n                  onChange={(e) => updateValue(field.id, e.target.value)}\n                  placeholder={field.placeholder}\n                  required={field.required}\n                />\n              ) : field.type === \"select\" ? (\n                <Select\n                  value={(values[field.id] as string) || \"\"}\n                  onValueChange={(v) => updateValue(field.id, v)}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder={field.placeholder || \"Select...\"} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {field.options?.map((opt) => (\n                      <SelectItem key={opt.value} value={opt.value}>\n                        {opt.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              ) : field.type === \"checkbox\" ? (\n                <div className=\"space-y-2\">\n                  {field.options?.map((opt) => (\n                    <div key={opt.value} className=\"flex items-center gap-2\">\n                      <Checkbox\n                        id={`${field.id}_${opt.value}`}\n                        checked={((values[field.id] as string[]) || []).includes(opt.value)}\n                        onCheckedChange={(checked) => {\n                          const current = (values[field.id] as string[]) || [];\n                          const updated = checked\n                            ? [...current, opt.value]\n                            : current.filter((v) => v !== opt.value);\n                          updateValue(field.id, updated);\n                        }}\n                      />\n                      <Label htmlFor={`${field.id}_${opt.value}`}>{opt.label}</Label>\n                    </div>\n                  ))}\n                </div>\n              ) : field.type === \"toggle\" ? (\n                <Switch\n                  id={field.id}\n                  checked={(values[field.id] as boolean) || false}\n                  onCheckedChange={(checked) => updateValue(field.id, checked)}\n                />\n              ) : (\n                <Input\n                  id={field.id}\n                  type={\n                    field.type === \"number\"\n                      ? \"number\"\n                      : field.type === \"email\"\n                        ? \"email\"\n                        : field.type === \"date\"\n                          ? \"date\"\n                          : field.type === \"datetime\"\n                            ? \"datetime-local\"\n                            : \"text\"\n                  }\n                  value={(values[field.id] as string) || \"\"}\n                  onChange={(e) => updateValue(field.id, e.target.value)}\n                  placeholder={field.placeholder}\n                  required={field.required}\n                />\n              )}\n\n              {field.description && (\n                <p className=\"text-xs text-muted-foreground\">{field.description}</p>\n              )}\n\n              {errors[field.id] && (\n                <p className=\"text-xs text-destructive\">{errors[field.id]}</p>\n              )}\n            </div>\n          )}\n        </div>\n      ))}\n\n      {onSubmit && (\n        <Button type=\"submit\" className=\"w-full\">\n          Submit\n        </Button>\n      )}\n    </form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/components/views/matrix-view.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[401,404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[401,404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":21,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[517,520],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[517,520],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport * as React from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport type { MatrixViewConfig } from \"@/lib/schema/types\";\n\ninterface MatrixItem {\n    id: string;\n    title: string;\n    subtitle?: string;\n    xValue: number;\n    yValue: number;\n    data: any;\n}\n\ninterface MatrixViewProps {\n    items: MatrixItem[];\n    config: MatrixViewConfig;\n    onItemClick?: (item: any) => void;\n}\n\nimport { motion, AnimatePresence } from \"framer-motion\";\n\nexport function MatrixView({ items, config, onItemClick }: MatrixViewProps) {\n    const getQuadrantItems = (quadrantId: number) => {\n        return items.filter((item) => {\n            const x = item.xValue;\n            const y = item.yValue;\n\n            if (quadrantId === 1) return x >= 6 && y >= 6;\n            if (quadrantId === 2) return x < 6 && y >= 6;\n            if (quadrantId === 3) return x >= 6 && y < 6;\n            if (quadrantId === 4) return x < 6 && y < 6;\n            return false;\n        });\n    };\n\n    return (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 h-full min-h-[600px] p-2\">\n            {config.quadrants.map((quadrant, _idx) => {\n                const quadrantItems = getQuadrantItems(quadrant.id);\n                const colorClass = getQuadrantColor(quadrant.color);\n\n                return (\n                    <Card\n                        key={quadrant.id}\n                        className={cn(\"flex flex-col border-border glass-morphism overflow-hidden shadow-2xl transition-all duration-500 hover:shadow-primary/5\", colorClass.bg)}\n                    >\n                        <CardHeader className={cn(\"py-6 px-8 flex flex-row items-center justify-between space-y-0 border-b border-border bg-background/10\")}>\n                            <div>\n                                <CardTitle className=\"text-[10px] font-black uppercase tracking-[0.2em] opacity-40 mb-1\">\n                                    {quadrant.label}\n                                </CardTitle>\n                                <p className=\"text-lg font-black tracking-tight opacity-90 leading-none\">\n                                    {quadrant.description}\n                                </p>\n                            </div>\n                            <Badge variant=\"secondary\" className=\"bg-muted backdrop-blur-xl border border-border text-[10px] font-black px-3 py-1\">\n                                {quadrantItems.length} ITEMS\n                            </Badge>\n                        </CardHeader>\n                        <CardContent className=\"flex-1 p-4 overflow-y-auto custom-scrollbar\">\n                            <div className=\"space-y-4\">\n                                <AnimatePresence mode=\"popLayout\">\n                                    {quadrantItems.map((item, itemIdx) => (\n                                        <motion.div\n                                            key={item.id}\n                                            layout\n                                            initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                                            animate={{ opacity: 1, y: 0, scale: 1 }}\n                                            exit={{ opacity: 0, scale: 0.9 }}\n                                            transition={{ duration: 0.3, delay: itemIdx * 0.05 }}\n                                            whileHover={{ scale: 1.01, y: -2, rotate: 0.5 }}\n                                            whileTap={{ scale: 0.99 }}\n                                            onClick={() => onItemClick?.(item.data)}\n                                            className=\"p-5 bg-white/[0.03] backdrop-blur-md hover:bg-white/[0.07] border border-border rounded-2xl cursor-pointer shadow-xl transition-all duration-300 group relative overflow-hidden\"\n                                        >\n                                            <div className=\"absolute top-0 left-0 w-1 h-full bg-primary/20 group-hover:bg-primary transition-colors\" />\n                                            <p className=\"text-xs font-black uppercase tracking-wider group-hover:text-primary transition-colors\">\n                                                {item.title}\n                                            </p>\n                                            {item.subtitle && (\n                                                <p className=\"text-[11px] font-bold text-muted-foreground mt-2 line-clamp-2 opacity-60\">\n                                                    {item.subtitle}\n                                                </p>\n                                            )}\n                                            <div className=\"flex gap-2 mt-4\">\n                                                <div className=\"flex items-center gap-1.5 text-[9px] font-black tracking-tighter text-muted-foreground/50 bg-muted px-2.5 py-1 rounded-lg border border-border shadow-inner\">\n                                                    <span className=\"opacity-40\">U</span>\n                                                    <span className=\"text-primary font-black opacity-100\">{item.xValue}</span>\n                                                </div>\n                                                <div className=\"flex items-center gap-1.5 text-[9px] font-black tracking-tighter text-muted-foreground/50 bg-muted px-2.5 py-1 rounded-lg border border-border shadow-inner\">\n                                                    <span className=\"opacity-40\">I</span>\n                                                    <span className=\"text-primary font-black opacity-100\">{item.yValue}</span>\n                                                </div>\n                                            </div>\n                                        </motion.div>\n                                    ))}\n                                </AnimatePresence>\n                                {quadrantItems.length === 0 && (\n                                    <div className=\"h-40 flex flex-col items-center justify-center p-8 text-muted-foreground/20 text-[10px] font-black tracking-[0.3em] uppercase opacity-50 border-2 border-dashed border-border rounded-3xl\">\n                                        Empty Quadrant\n                                    </div>\n                                )}\n                            </div>\n                        </CardContent>\n                    </Card>\n                );\n            })}\n        </div>\n    );\n}\n\nfunction getQuadrantColor(color?: string) {\n    switch (color) {\n        case 'red':\n            return { border: 'border-destructive/10', bg: 'bg-destructive/[0.02] shadow-[inner_0_0_50px_rgba(239,68,68,0.03)]' };\n        case 'blue':\n            return { border: 'border-semantic-info/10', bg: 'bg-semantic-info/[0.02]' };\n        case 'yellow':\n            return { border: 'border-semantic-warning/10', bg: 'bg-semantic-warning/[0.02]' };\n        case 'gray':\n            return { border: 'border-border', bg: 'bg-white/[0.01] shadow-[inner_0_0_50px_rgba(255,255,255,0.01)]' };\n        default:\n            return { border: 'border-border', bg: 'bg-white/[0.01]' };\n    }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/hooks/use-configuration.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":431,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":431,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[12572,12575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[12572,12575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":473,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":473,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13581,13584],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13581,13584],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[449,452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[449,452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { createClient } from '@/lib/supabase/client';\nimport { useUser } from './use-supabase';\nimport type {\n  LookupTable,\n  PageLayout,\n  TenantConfig,\n  TenantFeature,\n  UserRole,\n  Translation\n} from '@/lib/schemas/configuration';\n\n// Create supabase client instance\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst supabase = createClient() as any;\n\n// ============================================================================\n// LOOKUP TABLES HOOKS\n// ============================================================================\n\nexport function useLookupTables(tableName?: string) {\n  return useQuery({\n    queryKey: ['lookup-tables', tableName],\n    queryFn: async (): Promise<LookupTable[]> => {\n      let query = supabase\n        .from('lookup_tables')\n        .select('*')\n        .eq('is_active', true)\n        .order('position');\n\n      if (tableName) {\n        query = query.eq('table_name', tableName);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      return data as LookupTable[];\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\nexport function useLookupTable(tableName: string, key: string) {\n  return useQuery({\n    queryKey: ['lookup-table', tableName, key],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('lookup_tables')\n        .select('*')\n        .eq('table_name', tableName)\n        .eq('key', key)\n        .eq('is_active', true)\n        .single();\n\n      if (error) throw error;\n      return data as LookupTable;\n    },\n    enabled: !!tableName && !!key,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n// ============================================================================\n// PAGE LAYOUTS HOOKS\n// ============================================================================\n\nexport function usePageLayouts(filters?: {\n  layoutType?: string;\n  applicableAccountTypes?: string[];\n  applicableSubscriptionTiers?: string[];\n}) {\n  return useQuery({\n    queryKey: ['page-layouts', filters],\n    queryFn: async () => {\n      let query = supabase\n        .from('page_layouts')\n        .select('*')\n        .eq('is_active', true)\n        .order('position');\n\n      if (filters?.layoutType) {\n        query = query.eq('layout_type', filters.layoutType);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n\n      // Client-side filtering for account types and subscription tiers\n      let filteredData = data as PageLayout[];\n\n      if (filters?.applicableAccountTypes?.length) {\n        filteredData = filteredData.filter(layout =>\n          !layout.applicable_account_types.length ||\n          layout.applicable_account_types.some(type =>\n            filters.applicableAccountTypes!.includes(type)\n          )\n        );\n      }\n\n      if (filters?.applicableSubscriptionTiers?.length) {\n        filteredData = filteredData.filter(layout =>\n          !layout.applicable_subscription_tiers.length ||\n          layout.applicable_subscription_tiers.some(tier =>\n            filters.applicableSubscriptionTiers!.includes(tier)\n          )\n        );\n      }\n\n      return filteredData;\n    },\n    staleTime: 10 * 60 * 1000, // 10 minutes\n  });\n}\n\nexport function usePageLayout(slug: string) {\n  return useQuery({\n    queryKey: ['page-layout', slug],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('page_layouts')\n        .select('*')\n        .eq('slug', slug)\n        .eq('is_active', true)\n        .single();\n\n      if (error) throw error;\n      return data as PageLayout;\n    },\n    enabled: !!slug,\n    staleTime: 10 * 60 * 1000,\n  });\n}\n\nexport function useDefaultPageLayout(layoutType: string) {\n  return useQuery({\n    queryKey: ['default-page-layout', layoutType],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('page_layouts')\n        .select('*')\n        .eq('layout_type', layoutType)\n        .eq('is_default', true)\n        .eq('is_active', true)\n        .single();\n\n      if (error) throw error;\n      return data as PageLayout;\n    },\n    enabled: !!layoutType,\n    staleTime: 10 * 60 * 1000,\n  });\n}\n\n// ============================================================================\n// TENANT CONFIGURATION HOOKS\n// ============================================================================\n\nexport function useTenantConfig(organizationId: string, environment: string = 'production') {\n  return useQuery({\n    queryKey: ['tenant-config', organizationId, environment],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('tenant_config')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('environment', environment)\n        .eq('is_active', true);\n\n      if (error) throw error;\n      return data as TenantConfig[];\n    },\n    enabled: !!organizationId,\n    staleTime: 15 * 60 * 1000, // 15 minutes\n  });\n}\n\nexport function useTenantConfigValue(organizationId: string, configKey: string, environment: string = 'production') {\n  return useQuery({\n    queryKey: ['tenant-config-value', organizationId, configKey, environment],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('tenant_config')\n        .select('config_value')\n        .eq('organization_id', organizationId)\n        .eq('config_key', configKey)\n        .eq('environment', environment)\n        .eq('is_active', true)\n        .single();\n\n      if (error) throw error;\n      return data.config_value;\n    },\n    enabled: !!organizationId && !!configKey,\n    staleTime: 15 * 60 * 1000,\n  });\n}\n\n// ============================================================================\n// TENANT FEATURES HOOKS\n// ============================================================================\n\nexport function useTenantFeatures(organizationId: string) {\n  return useQuery({\n    queryKey: ['tenant-features', organizationId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('tenant_features')\n        .select('*')\n        .eq('organization_id', organizationId);\n\n      if (error) throw error;\n      return data as TenantFeature[];\n    },\n    enabled: !!organizationId,\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\nexport function useTenantFeature(organizationId: string, featureSlug: string) {\n  return useQuery({\n    queryKey: ['tenant-feature', organizationId, featureSlug],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('tenant_features')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('feature_slug', featureSlug)\n        .single();\n\n      if (error) throw error;\n      return data as TenantFeature;\n    },\n    enabled: !!organizationId && !!featureSlug,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\nexport function useFeatureEnabled(organizationId: string, featureSlug: string, userId?: string) {\n  return useQuery({\n    queryKey: ['feature-enabled', organizationId, featureSlug, userId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('tenant_features')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('feature_slug', featureSlug)\n        .single();\n\n      if (error) throw error;\n\n      const feature = data as TenantFeature;\n\n      // Check if feature is enabled globally\n      if (!feature.is_enabled) return false;\n\n      // Check rollout percentage (simplified - in production would use consistent hashing)\n      if (feature.rollout_percentage < 100) {\n        // For demo, assume current user is in rollout\n        // In production: check user ID against rollout logic\n        if (Math.random() * 100 > feature.rollout_percentage) return false;\n      }\n\n      // Check if user is in allowed users list\n      if (feature.allowed_users?.length && userId) {\n        return feature.allowed_users.includes(userId);\n      }\n\n      return true;\n    },\n    enabled: !!organizationId && !!featureSlug,\n    staleTime: 5 * 60 * 1000,\n  });\n}\n\n// ============================================================================\n// USER ROLES HOOKS\n// ============================================================================\n\nexport function useUserRoles(organizationId: string, userId?: string) {\n  return useQuery({\n    queryKey: ['user-roles', organizationId, userId],\n    queryFn: async () => {\n      let query = supabase\n        .from('user_roles')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('is_active', true);\n\n      if (userId) {\n        query = query.eq('user_id', userId);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      return data as UserRole[];\n    },\n    enabled: !!organizationId,\n    staleTime: 2 * 60 * 1000, // 2 minutes\n  });\n}\n\nexport function useUserRole(organizationId: string, userId: string, roleSlug: string) {\n  return useQuery({\n    queryKey: ['user-role', organizationId, userId, roleSlug],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('user_roles')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('user_id', userId)\n        .eq('role_slug', roleSlug)\n        .eq('is_active', true)\n        .single();\n\n      if (error) throw error;\n      return data as UserRole;\n    },\n    enabled: !!organizationId && !!userId && !!roleSlug,\n    staleTime: 2 * 60 * 1000,\n  });\n}\n\nexport function useUserPermissions(organizationId: string, userId: string) {\n  return useQuery({\n    queryKey: ['user-permissions', organizationId, userId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('user_roles')\n        .select('permissions')\n        .eq('organization_id', organizationId)\n        .eq('user_id', userId)\n        .eq('is_active', true);\n\n      if (error) throw error;\n\n      // Flatten and deduplicate permissions\n      const allPermissions = data.flatMap((role: UserRole) => role.permissions || []) as string[];\n      return Array.from(new Set(allPermissions));\n    },\n    enabled: !!organizationId && !!userId,\n    staleTime: 2 * 60 * 1000,\n  });\n}\n\n// ============================================================================\n// TRANSLATIONS HOOKS\n// ============================================================================\n\nexport function useTranslations(locale: string, namespace?: string) {\n  return useQuery({\n    queryKey: ['translations', locale, namespace],\n    queryFn: async () => {\n      let query = supabase\n        .from('translations')\n        .select('*')\n        .eq('locale', locale)\n        .eq('is_approved', true);\n\n      if (namespace) {\n        query = query.eq('namespace', namespace);\n      }\n\n      const { data, error } = await query;\n\n      if (error) throw error;\n      return data as Translation[];\n    },\n    enabled: !!locale,\n    staleTime: 30 * 60 * 1000, // 30 minutes\n  });\n}\n\nexport function useTranslation(locale: string, namespace: string, key: string) {\n  return useQuery({\n    queryKey: ['translation', locale, namespace, key],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('translations')\n        .select('value')\n        .eq('locale', locale)\n        .eq('namespace', namespace)\n        .eq('key', key)\n        .eq('is_approved', true)\n        .single();\n\n      if (error) throw error;\n      return data.value as string;\n    },\n    enabled: !!locale && !!namespace && !!key,\n    staleTime: 30 * 60 * 1000,\n  });\n}\n\n// Translation helper hook that returns a translation function\nexport function useTranslate(locale: string) {\n  const { data: translations } = useTranslations(locale);\n\n  const translate = (key: string, namespace: string = 'common', fallback?: string): string => {\n    if (!translations) return fallback || key;\n\n    const translation = translations.find(\n      t => t.namespace === namespace && t.key === key\n    );\n\n    return translation?.value || fallback || key;\n  };\n\n  return translate;\n}\n\n// ============================================================================\n// MUTATION HOOKS\n// ============================================================================\n\nexport function useUpdateTenantConfig() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({\n      organizationId,\n      configKey,\n      configValue,\n      configType,\n      environment = 'production'\n    }: {\n      organizationId: string;\n      configKey: string;\n      configValue: any;\n      configType: string;\n      environment?: string;\n    }) => {\n      const { data, error } = await supabase\n        .from('tenant_config')\n        .upsert({\n          organization_id: organizationId,\n          config_key: configKey,\n          config_value: configValue,\n          config_type: configType,\n          environment,\n          is_active: true,\n          updated_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['tenant-config'] });\n    },\n  });\n}\n\nexport function useUpdateTenantFeature() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({\n      organizationId,\n      featureSlug,\n      isEnabled,\n      config = {},\n      rolloutPercentage = 0,\n      allowedUsers = []\n    }: {\n      organizationId: string;\n      featureSlug: string;\n      isEnabled: boolean;\n      config?: Record<string, any>;\n      rolloutPercentage?: number;\n      allowedUsers?: string[];\n    }) => {\n      const { data, error } = await supabase\n        .from('tenant_features')\n        .upsert({\n          organization_id: organizationId,\n          feature_slug: featureSlug,\n          is_enabled: isEnabled,\n          config,\n          rollout_percentage: rolloutPercentage,\n          allowed_users: allowedUsers,\n          updated_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['tenant-features'] });\n    },\n  });\n}\n\nexport function useAssignUserRole() {\n  const queryClient = useQueryClient();\n  const { user } = useUser();\n\n  return useMutation({\n    mutationFn: async ({\n      organizationId,\n      userId,\n      roleSlug,\n      permissions = []\n    }: {\n      organizationId: string;\n      userId: string;\n      roleSlug: string;\n      permissions?: string[];\n    }) => {\n      const { data, error } = await supabase\n        .from('user_roles')\n        .upsert({\n          organization_id: organizationId,\n          user_id: userId,\n          role_slug: roleSlug,\n          permissions,\n          granted_by: user?.id,\n          granted_at: new Date().toISOString(),\n          is_active: true,\n          updated_at: new Date().toISOString(),\n        })\n        .select()\n        .single();\n\n      if (error) throw error;\n      return data;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['user-roles'] });\n      queryClient.invalidateQueries({ queryKey: ['user-permissions'] });\n    },\n  });\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/hooks/useRunsheetSync.ts","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'handleMessage'. Either include it or remove the dependency array.","line":145,"column":6,"nodeType":"ArrayExpression","endLine":145,"endColumn":36,"suggestions":[{"desc":"Update the dependencies array to be: [handleMessage, runsheetId, userId, userName]","fix":{"range":[4008,4038],"text":"[handleMessage, runsheetId, userId, userName]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\n\ninterface Cue {\n  id: string;\n  sequence: number;\n  name: string;\n  description?: string;\n  cue_type: string;\n  duration_seconds: number;\n  scheduled_time: string;\n  status: 'pending' | 'standby' | 'go' | 'complete' | 'skipped';\n  assigned_to_id?: string;\n  notes?: string;\n  script_text?: string;\n}\n\ninterface RunsheetState {\n  id: string;\n  name: string;\n  status: 'draft' | 'published' | 'live' | 'locked' | 'completed';\n  start_time: string;\n  current_cue_id: string | null;\n  show_mode_active: boolean;\n  version: number;\n  cues: Cue[];\n}\n\ninterface ActiveEditor {\n  userId: string;\n  userName: string;\n  cursor?: { cueId: string; field: string };\n  timestamp: number;\n}\n\ninterface SyncMessage {\n  type: 'state_update' | 'cue_update' | 'presence' | 'cue_go' | 'cue_skip' | 'show_mode';\n  payload: unknown;\n  version: number;\n  timestamp: number;\n  userId: string;\n}\n\ninterface UseRunsheetSyncOptions {\n  runsheetId: string;\n  userId: string;\n  userName: string;\n  onStateChange?: (state: RunsheetState) => void;\n  onPresenceChange?: (editors: ActiveEditor[]) => void;\n  onConflict?: (localVersion: number, serverVersion: number) => void;\n}\n\ninterface UseRunsheetSyncReturn {\n  state: RunsheetState | null;\n  activeEditors: ActiveEditor[];\n  isConnected: boolean;\n  isSyncing: boolean;\n  lastSyncedAt: Date | null;\n  error: string | null;\n  updateCue: (cueId: string, updates: Partial<Cue>) => void;\n  goCue: (cueId: string) => void;\n  skipCue: (cueId: string) => void;\n  setShowMode: (active: boolean) => void;\n  reorderCues: (cueIds: string[]) => void;\n  addCue: (cue: Omit<Cue, 'id'>) => void;\n  deleteCue: (cueId: string) => void;\n  reconnect: () => void;\n}\n\nexport function useRunsheetSync({\n  runsheetId,\n  userId,\n  userName,\n  onStateChange,\n  onPresenceChange,\n  onConflict,\n}: UseRunsheetSyncOptions): UseRunsheetSyncReturn {\n  const [state, setState] = useState<RunsheetState | null>(null);\n  const [activeEditors, setActiveEditors] = useState<ActiveEditor[]>([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const [isSyncing, setIsSyncing] = useState(false);\n  const [lastSyncedAt, setLastSyncedAt] = useState<Date | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const pendingUpdatesRef = useRef<SyncMessage[]>([]);\n  const localVersionRef = useRef<number>(0);\n\n  const connect = useCallback(() => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) return;\n\n    const wsUrl = `${process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:3001'}/runsheets/${runsheetId}`;\n    \n    try {\n      const ws = new WebSocket(wsUrl);\n      wsRef.current = ws;\n\n      ws.onopen = () => {\n        setIsConnected(true);\n        setError(null);\n        \n        // Send join message\n        ws.send(JSON.stringify({\n          type: 'join',\n          payload: { userId, userName },\n          timestamp: Date.now(),\n        }));\n\n        // Flush pending updates\n        pendingUpdatesRef.current.forEach((msg) => {\n          ws.send(JSON.stringify(msg));\n        });\n        pendingUpdatesRef.current = [];\n      };\n\n      ws.onmessage = (event) => {\n        try {\n          const message: SyncMessage = JSON.parse(event.data);\n          handleMessage(message);\n        } catch (e) {\n          console.error('Failed to parse WebSocket message:', e);\n        }\n      };\n\n      ws.onclose = () => {\n        setIsConnected(false);\n        wsRef.current = null;\n        \n        // Attempt reconnect after delay\n        reconnectTimeoutRef.current = setTimeout(() => {\n          connect();\n        }, 3000);\n      };\n\n      ws.onerror = (e) => {\n        console.error('WebSocket error:', e);\n        setError('Connection error. Retrying...');\n      };\n    } catch (e) {\n      console.error('Failed to create WebSocket:', e);\n      setError('Failed to connect');\n    }\n  }, [runsheetId, userId, userName]);\n\n  const handleMessage = useCallback((message: SyncMessage) => {\n    switch (message.type) {\n      case 'state_update':\n        const newState = message.payload as RunsheetState;\n        \n        // Check for version conflict\n        if (localVersionRef.current > 0 && message.version < localVersionRef.current) {\n          onConflict?.(localVersionRef.current, message.version);\n          return;\n        }\n        \n        localVersionRef.current = message.version;\n        setState(newState);\n        setLastSyncedAt(new Date(message.timestamp));\n        onStateChange?.(newState);\n        break;\n\n      case 'cue_update':\n        setState((prev) => {\n          if (!prev) return prev;\n          const { cueId, updates } = message.payload as { cueId: string; updates: Partial<Cue> };\n          return {\n            ...prev,\n            version: message.version,\n            cues: prev.cues.map((cue) =>\n              cue.id === cueId ? { ...cue, ...updates } : cue\n            ),\n          };\n        });\n        localVersionRef.current = message.version;\n        setLastSyncedAt(new Date(message.timestamp));\n        break;\n\n      case 'presence':\n        const editors = message.payload as ActiveEditor[];\n        setActiveEditors(editors.filter((e) => e.userId !== userId));\n        onPresenceChange?.(editors);\n        break;\n\n      case 'cue_go':\n        setState((prev) => {\n          if (!prev) return prev;\n          const { cueId } = message.payload as { cueId: string };\n          return {\n            ...prev,\n            current_cue_id: cueId,\n            show_mode_active: true,\n            cues: prev.cues.map((cue) => ({\n              ...cue,\n              status: cue.id === cueId ? 'go' : \n                      cue.status === 'go' ? 'complete' : cue.status,\n            })),\n          };\n        });\n        break;\n\n      case 'cue_skip':\n        setState((prev) => {\n          if (!prev) return prev;\n          const { cueId } = message.payload as { cueId: string };\n          return {\n            ...prev,\n            cues: prev.cues.map((cue) =>\n              cue.id === cueId ? { ...cue, status: 'skipped' } : cue\n            ),\n          };\n        });\n        break;\n\n      case 'show_mode':\n        setState((prev) => {\n          if (!prev) return prev;\n          const { active } = message.payload as { active: boolean };\n          return { ...prev, show_mode_active: active };\n        });\n        break;\n    }\n  }, [userId, onStateChange, onPresenceChange, onConflict]);\n\n  const sendMessage = useCallback((message: Omit<SyncMessage, 'timestamp' | 'userId'>) => {\n    const fullMessage: SyncMessage = {\n      ...message,\n      timestamp: Date.now(),\n      userId,\n    };\n\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(fullMessage));\n    } else {\n      // Queue for later\n      pendingUpdatesRef.current.push(fullMessage);\n    }\n  }, [userId]);\n\n  const updateCue = useCallback((cueId: string, updates: Partial<Cue>) => {\n    setIsSyncing(true);\n    \n    // Optimistic update\n    setState((prev) => {\n      if (!prev) return prev;\n      return {\n        ...prev,\n        version: prev.version + 1,\n        cues: prev.cues.map((cue) =>\n          cue.id === cueId ? { ...cue, ...updates } : cue\n        ),\n      };\n    });\n\n    sendMessage({\n      type: 'cue_update',\n      payload: { cueId, updates },\n      version: localVersionRef.current + 1,\n    });\n\n    setIsSyncing(false);\n  }, [sendMessage]);\n\n  const goCue = useCallback((cueId: string) => {\n    sendMessage({\n      type: 'cue_go',\n      payload: { cueId },\n      version: localVersionRef.current,\n    });\n  }, [sendMessage]);\n\n  const skipCue = useCallback((cueId: string) => {\n    sendMessage({\n      type: 'cue_skip',\n      payload: { cueId },\n      version: localVersionRef.current,\n    });\n  }, [sendMessage]);\n\n  const setShowMode = useCallback((active: boolean) => {\n    sendMessage({\n      type: 'show_mode',\n      payload: { active },\n      version: localVersionRef.current,\n    });\n  }, [sendMessage]);\n\n  const reorderCues = useCallback((cueIds: string[]) => {\n    setState((prev) => {\n      if (!prev) return prev;\n      const cueMap = new Map(prev.cues.map((c) => [c.id, c]));\n      const reorderedCues = cueIds\n        .map((id, index) => {\n          const cue = cueMap.get(id);\n          return cue ? { ...cue, sequence: index + 1 } : null;\n        })\n        .filter((c): c is Cue => c !== null);\n      \n      return { ...prev, cues: reorderedCues };\n    });\n\n    sendMessage({\n      type: 'state_update',\n      payload: { cueOrder: cueIds },\n      version: localVersionRef.current + 1,\n    });\n  }, [sendMessage]);\n\n  const addCue = useCallback((cue: Omit<Cue, 'id'>) => {\n    const newCue: Cue = {\n      ...cue,\n      id: `cue-${Date.now()}`,\n    };\n\n    setState((prev) => {\n      if (!prev) return prev;\n      return {\n        ...prev,\n        cues: [...prev.cues, newCue],\n      };\n    });\n\n    sendMessage({\n      type: 'state_update',\n      payload: { addCue: newCue },\n      version: localVersionRef.current + 1,\n    });\n  }, [sendMessage]);\n\n  const deleteCue = useCallback((cueId: string) => {\n    setState((prev) => {\n      if (!prev) return prev;\n      return {\n        ...prev,\n        cues: prev.cues.filter((c) => c.id !== cueId),\n      };\n    });\n\n    sendMessage({\n      type: 'state_update',\n      payload: { deleteCue: cueId },\n      version: localVersionRef.current + 1,\n    });\n  }, [sendMessage]);\n\n  const reconnect = useCallback(() => {\n    if (wsRef.current) {\n      wsRef.current.close();\n    }\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n    }\n    connect();\n  }, [connect]);\n\n  // Connect on mount\n  useEffect(() => {\n    connect();\n\n    return () => {\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n    };\n  }, [connect]);\n\n  // Send presence heartbeat\n  useEffect(() => {\n    const interval = setInterval(() => {\n      if (wsRef.current?.readyState === WebSocket.OPEN) {\n        wsRef.current.send(JSON.stringify({\n          type: 'presence',\n          payload: { userId, userName, timestamp: Date.now() },\n        }));\n      }\n    }, 30000);\n\n    return () => clearInterval(interval);\n  }, [userId, userName]);\n\n  return {\n    state,\n    activeEditors,\n    isConnected,\n    isSyncing,\n    lastSyncedAt,\n    error,\n    updateCue,\n    goCue,\n    skipCue,\n    setShowMode,\n    reorderCues,\n    addCue,\n    deleteCue,\n    reconnect,\n  };\n}\n\nexport default useRunsheetSync;\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/components/fields/index.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2777,2780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2777,2780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2802,2805],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2802,2805],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":75,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":75,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2926,2929],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2926,2929],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\n * FIELD RENDERER REGISTRY\n *\n * Maps field types to render components.\n * Add new field types here.\n */\n\nimport { FieldType, FieldDefinition } from '@/lib/schema/types';\n\n// Import all field components\nimport { TextField } from './TextField';\nimport { TextareaField } from './TextareaField';\nimport { RichtextField } from './RichtextField';\nimport { NumberField } from './NumberField';\nimport { CurrencyField } from './CurrencyField';\nimport { SelectField } from './SelectField';\nimport { MultiselectField } from './MultiselectField';\nimport { DateField } from './DateField';\nimport { DatetimeField } from './DatetimeField';\nimport { RelationField } from './RelationField';\nimport { FileField } from './FileField';\nimport { ImageField } from './ImageField';\nimport { CheckboxField } from './CheckboxField';\nimport { SwitchField } from './SwitchField';\nimport { LocationField } from './LocationField';\nimport { ColorField } from './ColorField';\nimport { TagsField } from './TagsField';\n// ... import all field types\n\nexport const fieldRenderers: Record<FieldType, React.ComponentType<FieldRenderProps>> = {\n  text: TextField,\n  textarea: TextareaField,\n  richtext: RichtextField,\n  code: TextareaField,      // Uses TextareaField with code formatting\n  number: NumberField,\n  currency: CurrencyField,\n  percentage: NumberField,  // Uses NumberField with % formatting\n  email: TextField,         // Uses TextField with email validation\n  phone: TextField,         // Uses TextField with phone formatting\n  url: TextField,           // Uses TextField with URL validation\n  select: SelectField,\n  multiselect: MultiselectField,\n  radio: SelectField,       // Uses SelectField with radio variant\n  checkbox: CheckboxField,\n  switch: SwitchField,\n  date: DateField,\n  datetime: DatetimeField,\n  time: DatetimeField,      // Uses DatetimeField with time-only mode\n  daterange: DateField,     // Uses DateField with range mode\n  duration: NumberField,    // Uses NumberField with duration formatting\n  file: FileField,\n  image: ImageField,\n  avatar: ImageField,       // Uses ImageField with circular crop\n  gallery: ImageField,      // Uses ImageField with multi-upload\n  relation: RelationField,\n  location: LocationField,\n  address: LocationField,   // Uses LocationField with address mode\n  color: ColorField,\n  rating: NumberField,      // Uses NumberField with star display\n  tags: TagsField,\n  json: TextareaField,      // Uses TextareaField with JSON formatting\n  signature: ImageField,    // Uses ImageField with signature pad\n  computed: () => null,     // Computed fields are read-only, rendered by display logic\n  custom: () => null,       // Handled by schema.renderField\n};\n\nexport interface FieldRenderProps {\n  field: FieldDefinition;\n  fieldKey: string;\n  value: any;\n  onChange: (value: any) => void;\n  error?: string;\n  disabled?: boolean;\n  mode: 'create' | 'edit' | 'table' | 'detail' | 'filter';\n  record?: any;\n}\n\n/**\n * DYNAMIC FIELD RENDERER\n *\n * Renders the appropriate field component based on field type.\n */\nexport function FieldRenderer(props: FieldRenderProps) {\n  const { field, ...rest } = props;\n\n  // Use custom renderer if provided\n  if (field.renderField) {\n    return field.renderField(props);\n  }\n\n  // Get renderer for field type\n  const Renderer = fieldRenderers[field.type];\n\n  if (!Renderer) {\n    console.warn(`No renderer for field type: ${field.type}`);\n    return null;\n  }\n\n  return <Renderer field={field} {...rest} />;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/crud/components/CrudList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":93,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":93,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2898,2901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2898,2901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { EntitySchema, EntityRecord } from '@/lib/schema/types';\nimport { useCrud } from '../hooks/useCrud';\nimport { useViewPreference } from '../hooks/useViewPreference';\nimport { useColumnPreference } from '../hooks/useColumnPreference';\nimport { ListLayout } from '@/lib/layouts';\nimport { ViewRenderer } from '@/lib/views/components/ViewRenderer';\nimport type { ViewType } from '@/lib/data-view-engine/hooks/use-data-view';\n\ninterface CrudListProps<T extends EntityRecord = EntityRecord> {\n  schema: EntitySchema<T>;\n  initialSubpage?: string;\n  filter?: Record<string, unknown>;\n}\n\n/**\n * GENERIC LIST COMPONENT\n *\n * Renders ANY entity list based on schema configuration.\n * Uses the unified ListLayout which accepts EntitySchema directly.\n */\nexport function CrudList<T extends EntityRecord>({\n  schema,\n  initialSubpage,\n  filter\n}: CrudListProps<T>) {\n  const router = useRouter();\n  const [currentSubpage, setCurrentSubpage] = useState(\n    initialSubpage || schema.layouts.list.subpages[0]?.key || 'all'\n  );\n\n  const [currentView, setCurrentView] = useViewPreference(\n    schema.identity.slug,\n    (schema.layouts.list.defaultView || 'table') as ViewType\n  );\n\n  // Build column definitions from schema for column preference\n  const schemaColumns = (schema.views?.table?.columns ?? []).map((col) => {\n    const fieldKey = typeof col === 'string' ? col : col.field;\n    const fieldDef = schema.data.fields[fieldKey];\n    return {\n      id: fieldKey,\n      label: fieldDef?.label || fieldKey,\n    };\n  });\n\n  const { visibleColumnIds } = useColumnPreference(schema.identity.slug, schemaColumns);\n\n  const subpageConfig = schema.layouts.list.subpages.find(s => s.key === currentSubpage);\n\n  const crud = useCrud(schema, {\n    query: {\n      ...subpageConfig?.query,\n      where: {\n        ...subpageConfig?.query?.where,\n        ...filter,\n      }\n    },\n  });\n\n  const handleRowClick = (item: T) => {\n    const id = (item as Record<string, unknown>)[schema.data.primaryKey || 'id'];\n    router.push(`/${schema.identity.slug}/${id}`);\n  };\n\n  const handleAction = (actionId: string) => {\n    if (actionId === 'create') {\n      router.push(`/${schema.identity.slug}/new`);\n    }\n  };\n\n  return (\n    <ListLayout\n      schema={schema}\n      data={crud.data as T[]}\n      loading={crud.loading}\n      error={crud.error}\n      currentSubpage={currentSubpage}\n      onSubpageChange={setCurrentSubpage}\n      currentView={currentView}\n      onViewChange={setCurrentView}\n      getRowId={(item) => String((item as Record<string, unknown>)[schema.data.primaryKey || 'id'])}\n      onRowClick={handleRowClick}\n      onAction={handleAction}\n      onRefresh={crud.refetch}\n    >\n      <ViewRenderer\n        schema={schema}\n        viewType={currentView}\n        viewConfig={(schema.views as Record<string, any>)[currentView] as Record<string, unknown>}\n        data={crud.data as T[]}\n        loading={crud.loading}\n        error={crud.error || undefined}\n        selection={crud.selection}\n        onSelectionChange={crud.setSelection}\n        pagination={crud.pagination}\n        onPaginationChange={crud.setPagination}\n        sort={crud.sort}\n        onSortChange={crud.onSortChange}\n        visibleColumns={currentView === 'table' ? visibleColumnIds : undefined}\n      />\n    </ListLayout>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/crud/components/DynamicForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":14,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":15,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[514,517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[514,517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":30,"column":80,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":83,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1106,1109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1106,1109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":70,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2300,2303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2300,2303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":71,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2333,2336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2333,2336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":100,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3077,3080],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3077,3080],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":104,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3243,3246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3243,3246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'autosave' is defined but never used. Allowed unused args must match /^_/u.","line":27,"column":68,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":76,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { useMemo } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { EntitySchema } from '@/lib/schema/types';\nimport { FieldRenderer } from '../../components/fields';\nimport { Button } from '@/components/ui/button';\nimport { generateZodSchema, extractFormFieldKeys } from '@/lib/schema/generateZodSchema';\n\ninterface DynamicFormProps {\n  schema: EntitySchema;\n  mode: 'create' | 'edit';\n  initialData?: any;\n  onSubmit: (data: any) => void | Promise<void>;\n  autosave?: boolean;\n}\n\n/**\n * DYNAMIC FORM COMPONENT\n *\n * Renders a form based on schema configuration.\n * Uses react-hook-form with zodResolver for validation.\n * Falls back to schema.validate and field.validate for custom rules.\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function DynamicForm({ schema, mode, initialData, onSubmit, autosave }: DynamicFormProps) {\n  // Generate Zod schema from field definitions\n  const zodSchema = useMemo(() => {\n    const formFieldKeys = extractFormFieldKeys(schema.layouts.form.sections as any[]);\n    return generateZodSchema(schema.data.fields, formFieldKeys, mode);\n  }, [schema, mode]);\n\n  const {\n    watch,\n    setValue,\n    handleSubmit: rhfHandleSubmit,\n    formState: { errors: rhfErrors, isSubmitting },\n    setError,\n    clearErrors,\n  } = useForm({\n    resolver: zodResolver(zodSchema),\n    defaultValues: initialData || {},\n    mode: 'onBlur',\n  });\n\n  const formData = watch();\n\n  const handleFieldChange = (fieldKey: string, value: unknown) => {\n    setValue(fieldKey, value, { shouldValidate: true, shouldDirty: true });\n    clearErrors(fieldKey);\n  };\n\n  const onFormSubmit = async (data: Record<string, unknown>) => {\n    // Run schema-level validation (backward compat)\n    const validationErrors: Record<string, string> = {};\n\n    if (schema.validate) {\n      const schemaErrors = schema.validate(data, mode);\n      if (schemaErrors) {\n        Object.assign(validationErrors, schemaErrors);\n      }\n    }\n\n    // Run field-level validation (backward compat)\n    Object.entries(schema.data.fields).forEach(([fieldKey, fieldDef]) => {\n      if (fieldDef.validate) {\n        const error = fieldDef.validate(data[fieldKey], {\n          mode,\n          record: data as any,\n          formData: data as any,\n        });\n        if (error) {\n          validationErrors[fieldKey] = error;\n        }\n      }\n    });\n\n    if (Object.keys(validationErrors).length > 0) {\n      Object.entries(validationErrors).forEach(([key, message]) => {\n        setError(key, { type: 'custom', message });\n      });\n      return;\n    }\n\n    try {\n      await onSubmit(data);\n    } catch (error) {\n      console.error('Form submission error:', error);\n    }\n  };\n\n  // Get error message for a field from react-hook-form\n  const getFieldError = (fieldKey: string): string | undefined => {\n    const err = rhfErrors[fieldKey];\n    if (!err) return undefined;\n    return typeof err.message === 'string' ? err.message : undefined;\n  };\n\n  const renderSection = (section: any) => {\n    // Check section-level condition\n    if (section.condition && !section.condition(formData)) return null;\n\n    const fields = section.fields.map((field: any) => {\n      const fieldKey = typeof field === 'string' ? field : field.fields?.[0];\n      const fieldDef = schema.data.fields[fieldKey];\n\n      if (!fieldDef) return null;\n\n      // Check visibility conditions\n      if (fieldDef.hidden) {\n        const isHidden = typeof fieldDef.hidden === 'function' \n          ? fieldDef.hidden({ mode, record: formData, formData })\n          : fieldDef.hidden;\n        if (isHidden) return null;\n      }\n\n      const isInlineLabel = fieldDef.type === 'checkbox' || fieldDef.type === 'switch';\n      const fieldError = getFieldError(fieldKey);\n\n      return (\n        <div key={fieldKey} className=\"space-y-1.5\">\n          {!isInlineLabel && (\n            <label htmlFor={fieldKey} className=\"block text-sm font-medium text-foreground\">\n              {fieldDef.label}\n              {fieldDef.required && <span className=\"text-destructive ml-1\">*</span>}\n            </label>\n          )}\n          <FieldRenderer\n            field={fieldDef}\n            fieldKey={fieldKey}\n            value={formData[fieldKey]}\n            onChange={(value) => handleFieldChange(fieldKey, value)}\n            error={fieldError}\n            mode={mode}\n            record={formData}\n          />\n          {!isInlineLabel && fieldDef.helpText && (\n            <p className=\"text-xs text-muted-foreground\">{fieldDef.helpText}</p>\n          )}\n          {!isInlineLabel && fieldError && (\n            <p className=\"text-xs text-destructive\">{fieldError}</p>\n          )}\n        </div>\n      );\n    });\n\n    return (\n      <div key={section.key} className=\"space-y-4\">\n        {section.title && (\n          <h3 className=\"text-lg font-medium text-foreground\">{section.title}</h3>\n        )}\n        {section.description && (\n          <p className=\"text-sm text-muted-foreground\">{section.description}</p>\n        )}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {fields}\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <form onSubmit={rhfHandleSubmit(onFormSubmit)} className=\"space-y-8\">\n      {schema.layouts.form.sections.map(renderSection)}\n\n      <div className=\"flex justify-end space-x-4 pt-6 border-t border-border\">\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          onClick={() => window.history.back()}\n        >\n          Cancel\n        </Button>\n        <Button\n          type=\"submit\"\n          disabled={isSubmitting}\n        >\n          {isSubmitting ? 'Saving...' : mode === 'create' ? 'Create' : 'Update'}\n        </Button>\n      </div>\n    </form>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/crud/components/TabRenderer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":5,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118,121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118,121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":6,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[133,136],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[133,136],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":69,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1797,1800],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1797,1800],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":98,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2640,2643],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2640,2643],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":112,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2960,2963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2960,2963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":122,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":122,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3114,3117],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3114,3117],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":135,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":135,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3436,3439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3436,3439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":148,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":148,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3741,3744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3741,3744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4069,4072],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4069,4072],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":161,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":161,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4082,4085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4082,4085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4821,4824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4821,4824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":189,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":189,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4834,4837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4834,4837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'onRefresh' is defined but never used. Allowed unused args must match /^_/u.","line":17,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":67,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'defaultView' is defined but never used. Allowed unused args must match /^_/u.","line":98,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":69,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'allowCreate' is defined but never used. Allowed unused args must match /^_/u.","line":98,"column":71,"nodeType":"Identifier","messageId":"unusedVar","endLine":98,"endColumn":82,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":12,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { EntitySchema } from '@/lib/schema/types';\n\ninterface TabRendererProps {\n  schema: EntitySchema;\n  tabConfig: any;\n  record: any;\n  onRefresh: () => void;\n}\n\n/**\n * TAB RENDERER COMPONENT\n *\n * Renders tab content based on schema configuration.\n * Supports overview, related entities, activity, comments, files, etc.\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport function TabRenderer({ schema, tabConfig, record, onRefresh }: TabRendererProps) {\n  if (!tabConfig) {\n    return (\n      <div className=\"flex items-center justify-center p-12\">\n        <p className=\"text-muted-foreground\">Tab configuration not found</p>\n      </div>\n    );\n  }\n\n  const { content } = tabConfig;\n\n  switch (content.type) {\n    case 'overview':\n      return <OverviewTab schema={schema} record={record} />;\n\n    case 'related':\n      return (\n        <RelatedTab\n          schema={schema}\n          relatedSchema={content.entity}\n          foreignKey={content.foreignKey}\n          record={record}\n          defaultView={content.defaultView}\n          allowCreate={content.allowCreate}\n        />\n      );\n\n    case 'activity':\n      return <ActivityTab record={record} />;\n\n    case 'comments':\n      return <CommentsTab record={record} />;\n\n    case 'files':\n      return <FilesTab record={record} />;\n\n    case 'custom':\n      // For custom components, we'd need a component registry\n      return <div>Custom tab: {content.component}</div>;\n\n    default:\n      return (\n        <div className=\"flex items-center justify-center p-12\">\n          <p className=\"text-muted-foreground\">Unknown tab type: {content.type}</p>\n        </div>\n      );\n  }\n}\n\n/**\n * Overview tab showing stats and key information\n */\nfunction OverviewTab({ schema, record }: { schema: EntitySchema; record: any }) {\n  const overview = schema.layouts.detail.overview;\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Quick Stats */}\n      {overview.stats && overview.stats.length > 0 && (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {overview.stats.map(stat => (\n            <StatCard key={stat.key} stat={stat} record={record} />\n          ))}\n        </div>\n      )}\n\n      {/* Overview Blocks */}\n      {overview.blocks.map(block => (\n        <OverviewBlock key={block.key} block={block} record={record} />\n      ))}\n    </div>\n  );\n}\n\nimport { CrudList } from './CrudList';\nimport { getSchema } from '@/lib/schemas';\n\n/**\n * Related entities tab\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction RelatedTab({ relatedSchema, foreignKey, record, defaultView, allowCreate }: any) {\n  const schema = getSchema(relatedSchema);\n\n  if (!schema) {\n    return (\n      <div className=\"p-6\">\n        <p className=\"text-destructive font-semibold\">Schema for &quot;{relatedSchema}&quot; not found</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-2\">\n      <CrudList\n        schema={schema as any}\n        filter={{ [foreignKey]: record.id }}\n      />\n    </div>\n  );\n}\n\n/**\n * Activity timeline tab\n */\nfunction ActivityTab({ record }: { record: any }) {\n  return (\n    <div className=\"p-6\">\n      <h3 className=\"text-lg font-medium mb-4\">Activity</h3>\n      <p className=\"text-muted-foreground\">Activity timeline for {record.id}</p>\n      {/* TODO: Implement activity timeline */}\n    </div>\n  );\n}\n\n/**\n * Comments tab\n */\nfunction CommentsTab({ record }: { record: any }) {\n  return (\n    <div className=\"p-6\">\n      <h3 className=\"text-lg font-medium mb-4\">Comments</h3>\n      <p className=\"text-muted-foreground\">Comments for {record.id}</p>\n      {/* TODO: Implement comments system */}\n    </div>\n  );\n}\n\n/**\n * Files tab\n */\nfunction FilesTab({ record }: { record: any }) {\n  return (\n    <div className=\"p-6\">\n      <h3 className=\"text-lg font-medium mb-4\">Files</h3>\n      <p className=\"text-muted-foreground\">Files attached to {record.id}</p>\n      {/* TODO: Implement file attachments */}\n    </div>\n  );\n}\n\n/**\n * Quick stat card component\n */\nfunction StatCard({ stat, record }: { stat: any; record: any }) {\n  // Compute stat value\n  let value: string | number = '';\n\n  if (stat.value.type === 'field') {\n    value = record[stat.value.field] || 0;\n  } else if (stat.value.type === 'computed') {\n    value = stat.value.compute(record);\n  }\n\n  // Format value\n  if (stat.format === 'currency') {\n    value = `$${value.toLocaleString()}`;\n  } else if (stat.format === 'percentage') {\n    value = `${value}%`;\n  }\n\n  return (\n    <div className=\"bg-card p-4 rounded-lg border border-border\">\n      <div className=\"text-2xl font-bold text-foreground\">{value}</div>\n      <div className=\"text-sm text-muted-foreground\">{stat.label}</div>\n    </div>\n  );\n}\n\n/**\n * Overview block component\n */\nfunction OverviewBlock({ block, record }: { block: any; record: any }) {\n  return (\n    <div className=\"bg-card p-6 rounded-lg border border-border\">\n      <h4 className=\"text-lg font-medium mb-4\">{block.title || block.key}</h4>\n\n      {block.content.type === 'fields' && (\n        <div className=\"space-y-4\">\n          {block.content.fields.map((field: string) => (\n            <div key={field} className=\"flex justify-between\">\n              <span className=\"text-muted-foreground\">{field}:</span>\n              <span className=\"font-medium\">{record[field] || 'N/A'}</span>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {block.content.type === 'description' && (\n        <div className=\"text-foreground whitespace-pre-wrap\">\n          {record[block.content.field]}\n        </div>\n      )}\n\n      {/* TODO: Implement other block types */}\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/crud/hooks/useCrud.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":12,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[389,392],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[389,392],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":197,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":197,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5864,5867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5864,5867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":204,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6033,6036],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6033,6036],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":207,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6145,6148],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6145,6148],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'id' is defined but never used. Allowed unused args must match /^_/u.","line":117,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":117,"endColumn":35,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react';\nimport { EntitySchema } from '@/lib/schema/types';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { throwApiErrorResponse } from '@/lib/api/error-message';\n\n/**\n * GENERIC CRUD HOOK\n *\n * Handles data operations for ANY entity based on schema.\n * NEVER add entity-specific logic here.\n */\nexport function useCrud<T = any>(schema: EntitySchema<T>, options?: CrudOptions) {\n  const queryClient = useQueryClient();\n  const endpoint = schema.data.endpoint;\n\n  // Build query params from options\n  const queryParams = useMemo(() => {\n    const params = new URLSearchParams();\n\n    if (options?.query?.where) {\n      params.set('where', JSON.stringify(options.query.where));\n    }\n    if (options?.query?.orderBy) {\n      params.set('orderBy', JSON.stringify(options.query.orderBy));\n    }\n    if (options?.pagination) {\n      params.set('page', String(options.pagination.page));\n      params.set('pageSize', String(options.pagination.pageSize));\n    }\n    if (options?.search) {\n      params.set('search', options.search);\n    }\n\n    return params.toString();\n  }, [options]);\n\n  // List query\n  const listQuery = useQuery({\n    queryKey: [schema.identity.slug, 'list', queryParams],\n    queryFn: async () => {\n      const url = queryParams ? `${endpoint}?${queryParams}` : endpoint;\n      const res = await fetch(url);\n      if (!res.ok) {\n        await throwApiErrorResponse(res, `Failed to load ${schema.identity.namePlural}`);\n      }\n      return res.json();\n    },\n  });\n\n  // Single record hook\n  const useRecord = (id: string) => {\n    return useQuery({\n      queryKey: [schema.identity.slug, 'record', id],\n      queryFn: async () => {\n        const res = await fetch(`${endpoint}/${id}`);\n        if (!res.ok) {\n          await throwApiErrorResponse(res, `Failed to load ${schema.identity.name}`);\n        }\n        return res.json();\n      },\n    });\n  };\n\n  // Create mutation\n  const createMutation = useMutation({\n    mutationFn: async (data: Partial<T>) => {\n      // Apply beforeCreate hook\n      let processedData = data;\n      if (schema.hooks?.beforeCreate) {\n        processedData = await schema.hooks.beforeCreate(data);\n      }\n\n      const res = await fetch(endpoint, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(processedData),\n      });\n\n      if (!res.ok) {\n        await throwApiErrorResponse(res, `Failed to create ${schema.identity.name}`);\n      }\n      return res.json();\n    },\n    onSuccess: async (record) => {\n      // Invalidate list queries\n      queryClient.invalidateQueries({ queryKey: [schema.identity.slug, 'list'] });\n\n      // Apply afterCreate hook\n      if (schema.hooks?.afterCreate) {\n        await schema.hooks.afterCreate(record);\n      }\n    },\n  });\n\n  // Update mutation\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<T> }) => {\n      // Apply beforeUpdate hook\n      let processedData = data;\n      if (schema.hooks?.beforeUpdate) {\n        const existing = queryClient.getQueryData([schema.identity.slug, 'record', id]);\n        processedData = await schema.hooks.beforeUpdate(id, data, existing as T);\n      }\n\n      const res = await fetch(`${endpoint}/${id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(processedData),\n      });\n\n      if (!res.ok) {\n        await throwApiErrorResponse(res, `Failed to update ${schema.identity.name}`);\n      }\n      return res.json();\n    },\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    onSuccess: async (record, { id, data }) => {\n      // Invalidate queries\n      queryClient.invalidateQueries({ queryKey: [schema.identity.slug] });\n\n      // Apply afterUpdate hook\n      if (schema.hooks?.afterUpdate) {\n        await schema.hooks.afterUpdate(record, data);\n      }\n    },\n  });\n\n  // Delete mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      // Apply beforeDelete hook\n      if (schema.hooks?.beforeDelete) {\n        const record = queryClient.getQueryData([schema.identity.slug, 'record', id]);\n        const canDelete = await schema.hooks.beforeDelete(id, record as T);\n        if (!canDelete) {\n          throw new Error('Delete prevented by hook');\n        }\n      }\n\n      const res = await fetch(`${endpoint}/${id}`, {\n        method: 'DELETE',\n      });\n\n      if (!res.ok) {\n        await throwApiErrorResponse(res, `Failed to delete ${schema.identity.name}`);\n      }\n      return id;\n    },\n    onSuccess: async (id) => {\n      // Invalidate queries\n      queryClient.invalidateQueries({ queryKey: [schema.identity.slug] });\n\n      // Apply afterDelete hook\n      if (schema.hooks?.afterDelete) {\n        await schema.hooks.afterDelete(id);\n      }\n    },\n  });\n\n  return {\n    // List data\n    data: listQuery.data?.records || [],\n    total: listQuery.data?.total || 0,\n    loading: listQuery.isLoading,\n    error: listQuery.error,\n    refetch: listQuery.refetch,\n\n    // Single record\n    useRecord,\n\n    // Mutations\n    create: createMutation.mutateAsync,\n    update: (id: string, data: Partial<T>) => updateMutation.mutateAsync({ id, data }),\n    delete: deleteMutation.mutateAsync,\n\n    // Mutation states\n    creating: createMutation.isPending,\n    updating: updateMutation.isPending,\n    deleting: deleteMutation.isPending,\n\n    // Selection state (for bulk actions)\n    selection: options?.selection || [],\n    setSelection: options?.onSelectionChange,\n\n    // Pagination state\n    pagination: options?.pagination,\n    setPagination: options?.onPaginationChange,\n\n    // Sort state\n    sort: options?.sort,\n    onSortChange: options?.onSortChange,\n  };\n}\n\ninterface CrudOptions {\n  query?: {\n    where?: Record<string, any>;\n    orderBy?: { field: string; direction: 'asc' | 'desc' };\n  };\n  pagination?: {\n    page: number;\n    pageSize: number;\n  };\n  onPaginationChange?: (pagination: any) => void;\n  search?: string;\n  sort?: { field: string; direction: 'asc' | 'desc' };\n  onSortChange?: (sort: any) => void;\n  selection?: string[];\n  onSelectionChange?: (ids: string[]) => void;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/julianclarkson/Documents/OrangeSeaDragon/atlvs/src/lib/navigation/redirects.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":1,"message":"Unexpected any. Specify a different type.","line":303,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":303,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6445,6448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6445,6448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// /lib/navigation/redirects.ts\n\n/**\n * REDIRECT MAP\n *\n * Maps old routes to new consolidated routes.\n * Used for:\n * 1. Next.js redirects in next.config.js\n * 2. In-app navigation migration\n * 3. Bookmarks/external links\n */\n\nexport interface RouteRedirect {\n  from: string;\n  to: string;\n  permanent: boolean;\n  preserveQuery?: boolean;\n  queryMapping?: Record<string, string>;  // Map old query params to new\n}\n\nexport const routeRedirects: RouteRedirect[] = [\n  // \n  // DASHBOARD CONSOLIDATION\n  // \n  {\n    from: '/dashboard',\n    to: '/',\n    permanent: true,\n  },\n  {\n    from: '/dashboard/overview',\n    to: '/',\n    permanent: true,\n  },\n  {\n    from: '/dashboard/activity',\n    to: '/?widget=activity',\n    permanent: true,\n  },\n  {\n    from: '/dashboard/analytics',\n    to: '/business/analytics',\n    permanent: true,\n  },\n\n  // \n  // EVENT CONSOLIDATION\n  // \n  {\n    from: '/projects/productions',\n    to: '/events',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/active',\n    to: '/events?subpage=active',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/archived',\n    to: '/events?subpage=archived',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/completed',\n    to: '/events?subpage=completed',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/new',\n    to: '/events/new',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/[id]',\n    to: '/events/[id]',\n    permanent: true,\n  },\n  {\n    from: '/projects/productions/[id]/edit',\n    to: '/events/[id]/edit',\n    permanent: true,\n  },\n\n  // \n  // VENUE CONSOLIDATION\n  // \n  {\n    from: '/locations',\n    to: '/venues',\n    permanent: true,\n  },\n  {\n    from: '/locations/[id]',\n    to: '/venues/[id]',\n    permanent: true,\n  },\n  {\n    from: '/locations/new',\n    to: '/venues/new',\n    permanent: true,\n  },\n  {\n    from: '/locations/[id]/edit',\n    to: '/venues/[id]/edit',\n    permanent: true,\n  },\n  {\n    from: '/projects/places/venue-management',\n    to: '/venues',\n    permanent: true,\n  },\n\n  // \n  // PEOPLE CONSOLIDATION\n  // \n  {\n    from: '/people/teams',\n    to: '/people?subpage=team',\n    permanent: true,\n  },\n  {\n    from: '/people/crew',\n    to: '/people?subpage=crew',\n    permanent: true,\n  },\n  {\n    from: '/people/contractors',\n    to: '/people?subpage=contractors',\n    permanent: true,\n  },\n  {\n    from: '/people/directory',\n    to: '/people',\n    permanent: true,\n  },\n  {\n    from: '/people/talent',\n    to: '/people?subpage=talent',\n    permanent: true,\n  },\n  {\n    from: '/business/contacts',\n    to: '/people?subpage=contacts',\n    permanent: true,\n  },\n\n  // \n  // FINANCE CONSOLIDATION\n  // \n  {\n    from: '/business/invoices',\n    to: '/invoices',\n    permanent: true,\n  },\n  {\n    from: '/business/invoices/[id]',\n    to: '/invoices/[id]',\n    permanent: true,\n  },\n  {\n    from: '/business/invoices/new',\n    to: '/invoices/new',\n    permanent: true,\n  },\n  {\n    from: '/business/invoices/[id]/edit',\n    to: '/invoices/[id]/edit',\n    permanent: true,\n  },\n  {\n    from: '/business/analytics',\n    to: '/business/analytics',\n    permanent: true,\n  },\n  {\n    from: '/business/insights',\n    to: '/business/analytics',\n    permanent: true,\n  },\n\n  // \n  // CONTENT CONSOLIDATION\n  // \n  {\n    from: '/documents',\n    to: '/content?subpage=documents',\n    permanent: true,\n  },\n  {\n    from: '/documents/[id]',\n    to: '/content/[id]',\n    permanent: true,\n  },\n  {\n    from: '/documents/new',\n    to: '/content/new',\n    permanent: true,\n  },\n  {\n    from: '/documents/[id]/edit',\n    to: '/content/[id]/edit',\n    permanent: true,\n  },\n  {\n    from: '/media',\n    to: '/content?subpage=media',\n    permanent: true,\n  },\n  {\n    from: '/media/[id]',\n    to: '/content/[id]',\n    permanent: true,\n  },\n  {\n    from: '/media/new',\n    to: '/content/new',\n    permanent: true,\n  },\n  {\n    from: '/media/[id]/edit',\n    to: '/content/[id]/edit',\n    permanent: true,\n  },\n\n  // \n  // WORKFLOW PAGES (Redirect to parent with action param)\n  // \n  {\n    from: '/(onboarding)/welcome',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/profile',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/organization_profile',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/billing_setup',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/integrations',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/preferences',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/skills_certifications',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/team_invite',\n    to: '/?action=onboarding',\n    permanent: true,\n  },\n  {\n    from: '/(onboarding)/complete',\n    to: '/',\n    permanent: true,\n  },\n\n  // \n  // MISC REDUNDANCIES\n  // \n  {\n    from: '/overview',\n    to: '/',\n    permanent: true,\n  },\n  {\n    from: '/home',\n    to: '/',\n    permanent: true,\n  },\n  {\n    from: '/expenses',\n    to: '/invoices',  // Assuming expenses are tracked as invoices\n    permanent: true,\n  },\n  {\n    from: '/tickets',\n    to: '/events',  // Assuming tickets are event-related\n    permanent: true,\n  },\n\n  // ADD ALL OTHER REDIRECTS BASED ON YOUR AUDIT\n];\n\n// Generate Next.js config format\nexport function generateNextRedirects(): any[] {\n  return routeRedirects.map(r => ({\n    source: r.from,\n    destination: r.to,\n    permanent: r.permanent,\n  }));\n}\n","usedDeprecatedRules":[]}]